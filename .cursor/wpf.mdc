---
alwaysApply: true
---

# Modern WPF Development Guide for Shouting Iguana

**Purpose:** This document defines the coding standards, design system, and architectural patterns for the Shouting Iguana WPF application. Follow these guidelines to maintain consistency and quality across the codebase.

------

## 1) Core Technology Stack

### UI Theme & Components
- **MaterialDesignInXamlToolkit** (`MaterialDesignThemes`, `MaterialDesignColors`)
  - Material Design 3 styling, components, dialogs, transitions
  - Custom palette configured for professional SEO tool aesthetic

### MVVM Framework
- **CommunityToolkit.Mvvm** - Lightweight MVVM with source generators
  - Use `[ObservableProperty]` for properties
  - Use `[RelayCommand]` for commands
  - Minimal boilerplate, excellent performance

### Dependency Injection
- **Microsoft.Extensions.DependencyInjection** - Standard DI container
- **Microsoft.Extensions.Hosting** - Host builder pattern for configuration

### Logging
- **Serilog** with file, debug, and console sinks
- Structured logging to `%LocalAppData%\ShoutingIguana\logs\`

### Other Libraries
- **Playwright** - Headless browser automation
- **EPPlus** - Excel export functionality
- **Entity Framework Core** - SQLite database access

------

## 2) Project Structure

```
ShoutingIguana/
  App.xaml / App.xaml.cs         # Application entry point, DI setup
  MainWindow.xaml                # Main window with menu, status bar
  
  Assets/                        # Images, icons (logo.png, logo.ico)
  
  Converters/                    # IValueConverter implementations
    InverseBooleanConverter.cs
    InverseBooleanToVisibilityConverter.cs
    NullToVisibilityConverter.cs
  
  Services/                      # Application services
    NavigationService.cs         # View navigation
    ProjectContext.cs            # Current project state
    CsvExportService.cs          # CSV export
    ExcelExportService.cs        # Excel export
  
  Styles/                        # Design system
    Styles.xaml                  # Complete design system (colors, typography, components)
  
  ViewModels/                    # One ViewModel per View
    MainViewModel.cs
    ProjectHomeViewModel.cs
    CrawlDashboardViewModel.cs
    FindingsViewModel.cs
    ExtensionsViewModel.cs
  
  Views/                         # UserControls (one per screen)
    ProjectHomeView.xaml
    CrawlDashboardView.xaml
    FindingsView.xaml
    ExtensionsView.xaml
    SettingsDialog.xaml
```

### Folder Rules

- **Views/**: UserControls only, no business logic, minimal code-behind
- **ViewModels/**: Pure C#, no UI types (no `Brush`, `MessageBox`, etc.)
- **Services/**: Interfaces + implementations, fully testable
- **Converters/**: Reusable IValueConverter implementations
- **Styles/**: Design system resources only

------

## 3) Design System

All styles are centralized in `Styles/Styles.xaml`. **Always use StaticResource references** - never hardcode colors, sizes, or spacing.

### Color Palette

```xml
<!-- Primary Colors -->
{StaticResource PrimaryBrush}        <!-- #0078D4 - Main brand color -->
{StaticResource PrimaryLightBrush}   <!-- #2B88D8 - Lighter variant -->
{StaticResource PrimaryDarkBrush}    <!-- #005A9E - Darker variant -->

<!-- Background & Surface -->
{StaticResource BackgroundBrush}     <!-- #F3F3F3 - Page background -->
{StaticResource SurfaceBrush}        <!-- #FFFFFF - Card/panel background -->
{StaticResource SurfaceVariantBrush} <!-- #FAFAFA - Alternate surface -->
{StaticResource SurfaceAltBrush}     <!-- #F5F5F5 - Zebra striping -->

<!-- Text (WCAG AA Compliant) -->
{StaticResource TextPrimaryBrush}    <!-- #1F1F1F - Primary text -->
{StaticResource TextSecondaryBrush}  <!-- #5A5A5A - Secondary text -->
{StaticResource TextTertiaryBrush}   <!-- #757575 - Hints, disabled -->

<!-- Semantic Colors -->
{StaticResource SuccessBrush}        <!-- #107C10 - Success/positive -->
{StaticResource WarningBrush}        <!-- #FFB900 - Warning/caution -->
{StaticResource ErrorBrush}          <!-- #D13438 - Error/danger -->
{StaticResource InfoBrush}           <!-- #0078D4 - Info/neutral -->

<!-- UI Elements -->
{StaticResource BorderBrush}         <!-- #E0E0E0 - Standard borders -->
{StaticResource BorderLightBrush}    <!-- #EEEEEE - Subtle dividers -->
{StaticResource DividerBrush}        <!-- #E0E0E0 - Separators -->
{StaticResource HoverBrush}          <!-- #F0F0F0 - Hover states -->
{StaticResource FocusBrush}          <!-- #0078D4 - Focus indicators -->
```

### Spacing System (4px base unit)

```xml
<!-- Thickness values -->
{StaticResource SpacingXS}   <!-- 4px -->
{StaticResource SpacingS}    <!-- 8px -->
{StaticResource SpacingM}    <!-- 16px -->
{StaticResource SpacingL}    <!-- 24px -->
{StaticResource SpacingXL}   <!-- 32px -->
{StaticResource SpacingXXL}  <!-- 48px -->

<!-- Double values (for Width, Height, FontSize) -->
{StaticResource SpacingXSValue}   <!-- 4 -->
{StaticResource SpacingSValue}    <!-- 8 -->
{StaticResource SpacingMValue}    <!-- 16 -->
{StaticResource SpacingLValue}    <!-- 24 -->
{StaticResource SpacingXLValue}   <!-- 32 -->
{StaticResource SpacingXXLValue}  <!-- 48 -->
```

**Usage:**
```xml
<!-- Good -->
<Grid Margin="{StaticResource SpacingL}">
<StackPanel Margin="0,0,0,24">  <!-- Exception: custom spacing between elements -->

<!-- Bad -->
<Grid Margin="15,20,15,20">  <!-- Never hardcode -->
```

### Typography Scale

```xml
<!-- Text Styles -->
{StaticResource DisplayTextStyle}   <!-- 28px, SemiBold - Page titles -->
{StaticResource TitleTextStyle}     <!-- 20px, SemiBold - Section headers -->
{StaticResource BodyTextStyle}      <!-- 14px, Normal - Standard text -->
{StaticResource CaptionTextStyle}   <!-- 12px, Normal - Metadata, labels -->
```

**Usage:**
```xml
<TextBlock Text="Findings" 
           Style="{StaticResource DisplayTextStyle}"
           AutomationProperties.HeadingLevel="Level1"/>
           
<TextBlock Text="Recent Activity" 
           Style="{StaticResource TitleTextStyle}"
           AutomationProperties.HeadingLevel="Level2"/>
           
<TextBlock Text="{Binding Description}" 
           Style="{StaticResource BodyTextStyle}"/>
           
<TextBlock Text="Last updated: 2 mins ago" 
           Style="{StaticResource CaptionTextStyle}"
           Foreground="{StaticResource TextSecondaryBrush}"/>
```

### Button Styles

```xml
<!-- Primary Action -->
<Button Content="Start Crawl"
        Command="{Binding StartCommand}"
        Style="{StaticResource PrimaryButton}"/>

<!-- Secondary Action -->
<Button Content="Cancel"
        Command="{Binding CancelCommand}"
        Style="{StaticResource SecondaryButton}"/>

<!-- Destructive Action -->
<Button Content="Delete Project"
        Command="{Binding DeleteCommand}"
        Style="{StaticResource DangerButton}"/>

<!-- Prominent Action (larger) -->
<Button Content="Create Project"
        Command="{Binding CreateCommand}"
        Style="{StaticResource LargeButton}"/>
```

**Button Guidelines:**
- Primary: Main action (1 per section max)
- Secondary: Alternative/cancel actions
- Danger: Destructive operations (delete, stop, clear)
- Large: Hero actions on landing screens

### Card Styles

```xml
<!-- Standard Card (default for content sections) -->
<md:Card Style="{StaticResource StandardCard}">
    <!-- Content -->
</md:Card>

<!-- Metric Card (dashboard stats) -->
<md:Card Style="{StaticResource MetricCard}">
    <!-- Stat content -->
</md:Card>

<!-- Info Card (notices, tips) -->
<md:Card Style="{StaticResource InfoCard}">
    <!-- Info message -->
</md:Card>

<!-- Message Cards -->
<md:Card Style="{StaticResource ErrorMessageCard}"/>
<md:Card Style="{StaticResource WarningMessageCard}"/>
<md:Card Style="{StaticResource SuccessMessageCard}"/>
```

### Input Styles

```xml
<!-- Text Input -->
<TextBox Text="{Binding ProjectName, UpdateSourceTrigger=PropertyChanged}"
         md:HintAssist.Hint="Project Name"
         Style="{StaticResource StandardTextBox}"
         AutomationProperties.Name="Project Name"
         ToolTip="Enter a descriptive name for your project"/>

<!-- ComboBox -->
<ComboBox SelectedValue="{Binding SelectedSeverity}"
          Style="{StaticResource StandardComboBox}"
          AutomationProperties.Name="Filter by Severity"/>

<!-- CheckBox -->
<CheckBox Content="Respect robots.txt"
          IsChecked="{Binding RespectRobotsTxt}"
          Style="{StaticResource StandardCheckBox}"
          AutomationProperties.Name="Respect Robots.txt"/>
```

### DataGrid Style

```xml
<DataGrid ItemsSource="{Binding Items}"
          SelectedItem="{Binding SelectedItem}"
          Style="{StaticResource ModernDataGrid}">
    <DataGrid.Columns>
        <DataGridTextColumn Header="Name" Binding="{Binding Name}" Width="*"/>
        <DataGridTextColumn Header="Status" Binding="{Binding Status}" Width="120"/>
    </DataGrid.Columns>
</DataGrid>
```

Features:
- No grid lines
- Alternating row backgrounds
- Hover effects
- Row height: 40px
- Column headers: 44px height, semibold, subtle background

### Progress Bar

```xml
<ProgressBar Value="{Binding ProgressPercentage}"
             Maximum="100"
             Style="{StaticResource ModernProgressBar}"
             Height="12"/>
```

### Severity Badges

```xml
<!-- Use in DataGrid or custom layouts -->
<Border Style="{StaticResource ErrorSeverityBadge}">
    <TextBlock Text="Error"/>
</Border>

<Border Style="{StaticResource WarningSeverityBadge}">
    <TextBlock Text="Warning"/>
</Border>

<Border Style="{StaticResource InfoSeverityBadge}">
    <TextBlock Text="Info"/>
</Border>
```

### Status Badges

```xml
<Border Style="{StaticResource ActiveStatusBadge}">
    <TextBlock Text="Active"/>
</Border>

<Border Style="{StaticResource LoadedStatusBadge}">
    <TextBlock Text="Loaded"/>
</Border>
```

### Empty States

```xml
<StackPanel Style="{StaticResource EmptyStateContainer}">
    <md:PackIcon Kind="FolderOutline" 
                 Style="{StaticResource EmptyStateIcon}"/>
    <TextBlock Text="No Recent Projects" 
               Style="{StaticResource EmptyStateTitle}"/>
    <TextBlock Text="Create a new project to get started" 
               Style="{StaticResource EmptyStateMessage}"/>
</StackPanel>
```

### Focus Visual Styles

```xml
<!-- Standard focus (buttons, inputs) -->
FocusVisualStyle="{StaticResource ModernFocusVisual}"

<!-- Card focus (larger interactive areas) -->
FocusVisualStyle="{StaticResource CardFocusVisual}"
```

------

## 4) Accessibility Requirements

**ALL UI elements MUST meet these requirements:**

### Interactive Elements

Every button, link, input, and interactive control MUST have:

```xml
<Button Content="Export"
        Command="{Binding ExportCommand}"
        AutomationProperties.Name="Export to CSV"
        ToolTip="Export findings to CSV file"/>
```

- `AutomationProperties.Name` - Screen reader label (describe action)
- `ToolTip` - Visual tooltip (provide context)

### Headings

All section titles MUST have heading levels:

```xml
<TextBlock Text="Project Settings"
           Style="{StaticResource DisplayTextStyle}"
           AutomationProperties.HeadingLevel="Level1"/>

<TextBlock Text="Basic Information"
           Style="{StaticResource TitleTextStyle}"
           AutomationProperties.HeadingLevel="Level2"/>
```

**Heading hierarchy:**
- Level1: Page title (one per view)
- Level2: Major sections
- Level3: Subsections (if needed)

### Keyboard Navigation

- All interactive elements MUST be keyboard accessible
- Use `TabIndex` to control focus order when default is incorrect
- Set `FocusVisualStyle` for custom focus indicators
- Test with Tab, Shift+Tab, Enter, Space, Arrow keys

### Keyboard Shortcuts

Defined in `MainWindow.xaml`:
```
Ctrl+N      New Project
Ctrl+O      Open Project
Ctrl+W      Close Project
Ctrl+1-4    Navigate to views
F5          Refresh
F6          Start Crawl
F8          Stop Crawl
```

Always show shortcuts in menu items:
```xml
<MenuItem Header="_Start Crawl" 
          Command="{Binding StartCrawlCommand}" 
          InputGestureText="F6"/>
```

### Color Contrast

All text must meet WCAG AA standards (4.5:1 for normal text, 3:1 for large text). The design system colors are pre-validated.

### High Contrast Mode

The app supports Windows High Contrast themes automatically. Test with:
- Settings > Accessibility > Contrast themes

------

## 5) MVVM Architecture

### ViewModel Structure

```csharp
using CommunityToolkit.Mvvm.ComponentModel;
using CommunityToolkit.Mvvm.Input;
using Microsoft.Extensions.Logging;

namespace ShoutingIguana.ViewModels;

public partial class ExampleViewModel : ObservableObject, IDisposable
{
    private readonly ILogger<ExampleViewModel> _logger;
    private readonly IExampleService _service;
    private bool _disposed;

    // Observable Properties (generates property + PropertyChanged)
    [ObservableProperty]
    private string _title = "Default Title";

    [ObservableProperty]
    private bool _isLoading;

    [ObservableProperty]
    private ObservableCollection<Item> _items = new();

    // Constructor with DI
    public ExampleViewModel(
        ILogger<ExampleViewModel> logger,
        IExampleService service)
    {
        _logger = logger;
        _service = service;
        
        // Subscribe to events
        _service.DataChanged += OnDataChanged;
    }

    // Relay Commands (generates command + CanExecute)
    [RelayCommand]
    private async Task LoadDataAsync()
    {
        IsLoading = true;
        try
        {
            var data = await _service.GetDataAsync();
            Items.Clear();
            foreach (var item in data)
            {
                Items.Add(item);
            }
            _logger.LogInformation("Loaded {Count} items", Items.Count);
        }
        catch (Exception ex)
        {
            _logger.LogError(ex, "Failed to load data");
            // Show error to user (via service, not MessageBox)
        }
        finally
        {
            IsLoading = false;
        }
    }

    [RelayCommand(CanExecute = nameof(CanSave))]
    private async Task SaveAsync()
    {
        // Save logic
    }

    private bool CanSave() => !string.IsNullOrWhiteSpace(Title);

    // Event handlers
    private void OnDataChanged(object? sender, EventArgs e)
    {
        // Update UI
    }

    // Disposal
    public void Dispose()
    {
        if (_disposed) return;
        
        // Unsubscribe from events
        _service.DataChanged -= OnDataChanged;
        
        _disposed = true;
    }
}
```

### ViewModel Rules

1. **No UI Types**: Never reference `Window`, `MessageBox`, `Brush`, `Visibility`, etc.
2. **Async Commands**: Use `Task` return type for async operations
3. **Error Handling**: Log errors, don't swallow them
4. **Disposal**: Implement `IDisposable` if subscribing to events
5. **Property Names**: Use PascalCase for observable properties
6. **UpdateSourceTrigger**: Use `PropertyChanged` for real-time validation

### View Structure

```xml
<UserControl x:Class="ShoutingIguana.Views.ExampleView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:md="http://materialdesigninxaml.net/winfx/xaml/themes"
             Background="{StaticResource BackgroundBrush}">
    
    <Grid Margin="{StaticResource SpacingL}">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <Grid Grid.Row="0" Margin="{StaticResource SpacingL}">
            <TextBlock Text="Page Title"
                       Style="{StaticResource DisplayTextStyle}"
                       AutomationProperties.HeadingLevel="Level1"/>
            
            <StackPanel Style="{StaticResource ToolbarPanel}">
                <Button Content="Action"
                        Command="{Binding ActionCommand}"
                        Style="{StaticResource PrimaryButton}"/>
            </StackPanel>
        </Grid>

        <!-- Content -->
        <md:Card Grid.Row="1" Style="{StaticResource StandardCard}">
            <!-- Your content here -->
        </md:Card>
    </Grid>
</UserControl>
```

### View Code-Behind

**Minimal code-behind only:**

```csharp
using System.Windows.Controls;

namespace ShoutingIguana.Views;

public partial class ExampleView : UserControl
{
    public ExampleView()
    {
        InitializeComponent();
    }
}
```

**Never put business logic in code-behind.** Only handle pure UI concerns that can't be done in XAML.

------

## 6) Navigation Pattern

### INavigationService

```csharp
public interface INavigationService
{
    event EventHandler<UserControl>? NavigationRequested;
    void NavigateTo<T>() where T : UserControl;
    void NavigateTo(UserControl view);
}
```

### Usage in ViewModels

```csharp
[RelayCommand]
private void NavigateToSettings()
{
    _navigationService.NavigateTo<SettingsView>();
}
```

### Navigation Lifecycle

1. `NavigationService.NavigateTo<T>()` is called
2. Service creates view instance via DI (ViewModel injected)
3. Service disposes previous view's DataContext if `IDisposable`
4. Service raises `NavigationRequested` event
5. `MainViewModel` receives event and updates `CurrentView` property
6. WPF ContentControl displays new view

### ViewModel Disposal

ViewModels are disposed automatically when navigating away:

```csharp
public partial class MyViewModel : ObservableObject, IDisposable
{
    private bool _disposed;

    public MyViewModel(IMyService service)
    {
        _service = service;
        _service.EventOccurred += OnEventOccurred;
    }

    public void Dispose()
    {
        if (_disposed) return;
        
        // CRITICAL: Unsubscribe from all events
        _service.EventOccurred -= OnEventOccurred;
        
        // Dispose owned resources
        _someDisposable?.Dispose();
        
        _disposed = true;
    }
}
```

**Memory Leak Prevention:**
- Always unsubscribe from events in `Dispose()`
- Don't capture `this` in lambdas that outlive the ViewModel
- Use weak event patterns for long-lived event sources

------

## 7) Dependency Injection

### Registration in App.xaml.cs

```csharp
services.AddSingleton<INavigationService, NavigationService>();
services.AddSingleton<IProjectContext, ProjectContext>();
services.AddScoped<IUrlRepository, UrlRepository>();
services.AddTransient<ProjectHomeViewModel>();
```

### Lifetimes

- **Singleton**: Lives for app lifetime (services, caches)
  - `INavigationService`, `IProjectContext`, `IPlaywrightService`
  
- **Scoped**: Lives for scope lifetime (database contexts)
  - `IShoutingIguanaDbContext`, repositories
  
- **Transient**: New instance every time (ViewModels)
  - All ViewModels (ensures clean state on navigation)

### Service Patterns

**Interface + Implementation:**
```csharp
// IMyService.cs
public interface IMyService
{
    Task<Data> GetDataAsync();
}

// MyService.cs
public class MyService : IMyService
{
    private readonly ILogger<MyService> _logger;

    public MyService(ILogger<MyService> logger)
    {
        _logger = logger;
    }

    public async Task<Data> GetDataAsync()
    {
        _logger.LogInformation("Getting data...");
        // Implementation
    }
}

// Registration
services.AddSingleton<IMyService, MyService>();
```

------

## 8) Value Converters

### Built-in Converters

```xml
<!-- In App.xaml -->
<BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter"/>
<converters:InverseBooleanConverter x:Key="InverseBooleanConverter"/>
<converters:InverseBooleanToVisibilityConverter x:Key="InverseBooleanToVisibilityConverter"/>
<converters:NullToVisibilityConverter x:Key="NullToVisibilityConverter"/>
```

### Usage Examples

```xml
<!-- Show/hide based on boolean -->
<TextBlock Text="Loading..." 
           Visibility="{Binding IsLoading, Converter={StaticResource BooleanToVisibilityConverter}}"/>

<!-- Invert boolean (for IsEnabled) -->
<Button Content="Start"
        IsEnabled="{Binding IsCrawling, Converter={StaticResource InverseBooleanConverter}}"/>

<!-- Show when NOT loading -->
<DataGrid Visibility="{Binding IsLoading, Converter={StaticResource InverseBooleanToVisibilityConverter}}"/>

<!-- Show when object is not null -->
<Button Visibility="{Binding CurrentProject, Converter={StaticResource NullToVisibilityConverter}}"/>
```

### Creating Custom Converters

```csharp
using System;
using System.Globalization;
using System.Windows.Data;

namespace ShoutingIguana.Converters;

public class StatusToColorConverter : IValueConverter
{
    public object Convert(object value, Type targetType, object parameter, CultureInfo culture)
    {
        if (value is Status status)
        {
            return status switch
            {
                Status.Active => Application.Current.FindResource("SuccessBrush"),
                Status.Error => Application.Current.FindResource("ErrorBrush"),
                _ => Application.Current.FindResource("TextSecondaryBrush")
            };
        }
        return Binding.DoNothing;
    }

    public object ConvertBack(object value, Type targetType, object parameter, CultureInfo culture)
    {
        throw new NotImplementedException();
    }
}
```

Register in App.xaml:
```xml
<converters:StatusToColorConverter x:Key="StatusToColorConverter"/>
```

------

## 9) Common UI Patterns

### Page Header with Toolbar

```xml
<Grid Margin="{StaticResource SpacingL}">
    <TextBlock Text="Findings"
               Style="{StaticResource DisplayTextStyle}"
               VerticalAlignment="Center"
               AutomationProperties.HeadingLevel="Level1"/>
    
    <StackPanel Style="{StaticResource ToolbarPanel}">
        <Button Command="{Binding RefreshCommand}"
                Style="{StaticResource SecondaryButton}"
                Margin="0,0,8,0">
            <StackPanel Orientation="Horizontal">
                <md:PackIcon Kind="Refresh" Width="16" Height="16" Margin="0,0,6,0"/>
                <TextBlock Text="Refresh"/>
            </StackPanel>
        </Button>
        <Button Command="{Binding ExportCommand}"
                Style="{StaticResource PrimaryButton}">
            <StackPanel Orientation="Horizontal">
                <md:PackIcon Kind="Export" Width="16" Height="16" Margin="0,0,6,0"/>
                <TextBlock Text="Export"/>
            </StackPanel>
        </Button>
    </StackPanel>
</Grid>
```

### Metric Card

```xml
<md:Card Style="{StaticResource MetricCard}"
         BorderBrush="{StaticResource SuccessBrush}"
         BorderThickness="4,0,0,0">
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>
        
        <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,8">
            <md:PackIcon Kind="CheckCircleOutline" 
                         Width="20" Height="20"
                         Foreground="{StaticResource SuccessBrush}"
                         Margin="0,0,8,0"/>
            <TextBlock Text="URLs Crawled"
                       Style="{StaticResource BodyTextStyle}"
                       Foreground="{StaticResource TextSecondaryBrush}"/>
        </StackPanel>
        
        <TextBlock Grid.Row="1"
                   Text="{Binding UrlsCrawled}"
                   Style="{StaticResource DisplayTextStyle}"
                   FontSize="32"
                   Foreground="{StaticResource SuccessBrush}"/>
    </Grid>
</md:Card>
```

### Responsive Grid Layout

```xml
<Grid>
    <Grid.ColumnDefinitions>
        <ColumnDefinition Width="*"/>
        <ColumnDefinition Width="16"/>  <!-- Gutter -->
        <ColumnDefinition Width="*"/>
        <ColumnDefinition Width="16"/>
        <ColumnDefinition Width="*"/>
    </Grid.ColumnDefinitions>
    
    <md:Card Grid.Column="0" Style="{StaticResource MetricCard}"/>
    <md:Card Grid.Column="2" Style="{StaticResource MetricCard}"/>
    <md:Card Grid.Column="4" Style="{StaticResource MetricCard}"/>
</Grid>
```

### Form Layout

```xml
<Grid>
    <Grid.ColumnDefinitions>
        <ColumnDefinition Width="*"/>
        <ColumnDefinition Width="16"/>
        <ColumnDefinition Width="*"/>
    </Grid.ColumnDefinitions>
    <Grid.RowDefinitions>
        <RowDefinition Height="Auto"/>
        <RowDefinition Height="Auto"/>
    </Grid.RowDefinitions>

    <TextBox Grid.Row="0" Grid.Column="0"
             Text="{Binding ProjectName, UpdateSourceTrigger=PropertyChanged}"
             md:HintAssist.Hint="Project Name"
             Style="{StaticResource StandardTextBox}"
             Margin="0,0,0,20"/>

    <TextBox Grid.Row="0" Grid.Column="2"
             Text="{Binding BaseUrl, UpdateSourceTrigger=PropertyChanged}"
             md:HintAssist.Hint="Base URL"
             Style="{StaticResource StandardTextBox}"
             Margin="0,0,0,20"/>

    <CheckBox Grid.Row="1" Grid.Column="0"
              Content="Respect robots.txt"
              IsChecked="{Binding RespectRobotsTxt}"
              Margin="0,8,0,0"/>
</Grid>
```

### Loading Overlay

```xml
<Grid>
    <!-- Main content -->
    <ContentControl Content="{Binding MainContent}"/>
    
    <!-- Loading overlay -->
    <Grid Style="{StaticResource LoadingOverlay}"
          Visibility="{Binding IsLoading, Converter={StaticResource BooleanToVisibilityConverter}}">
        <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center">
            <ProgressBar IsIndeterminate="True" Width="200" Height="4"/>
            <TextBlock Text="Loading..." 
                       Style="{StaticResource BodyTextStyle}"
                       Margin="0,16,0,0"
                       HorizontalAlignment="Center"/>
        </StackPanel>
    </Grid>
</Grid>
```

### Context Menu on DataGrid

```xml
<DataGrid ItemsSource="{Binding Items}">
    <DataGrid.ContextMenu>
        <ContextMenu>
            <MenuItem Header="Copy URL" 
                      Command="{Binding CopyUrlCommand}"
                      AutomationProperties.Name="Copy URL to Clipboard">
                <MenuItem.Icon>
                    <md:PackIcon Kind="ContentCopy" Width="16" Height="16"/>
                </MenuItem.Icon>
            </MenuItem>
            <Separator/>
            <MenuItem Header="Open in Browser" 
                      Command="{Binding OpenInBrowserCommand}">
                <MenuItem.Icon>
                    <md:PackIcon Kind="OpenInNew" Width="16" Height="16"/>
                </MenuItem.Icon>
            </MenuItem>
        </ContextMenu>
    </DataGrid.ContextMenu>
</DataGrid>
```

### Welcome Screen with Animation

```xml
<md:Card Padding="{StaticResource SpacingXXL}" 
         md:ElevationAssist.Elevation="Dp4"
         UniformCornerRadius="12"
         MaxWidth="500">
    <md:Card.RenderTransform>
        <TranslateTransform/>
    </md:Card.RenderTransform>
    <md:Card.Triggers>
        <EventTrigger RoutedEvent="Loaded">
            <BeginStoryboard>
                <Storyboard>
                    <DoubleAnimation Storyboard.TargetProperty="(UIElement.RenderTransform).(TranslateTransform.Y)"
                                     From="20" To="0" Duration="0:0:0.4"
                                     DecelerationRatio="0.7"/>
                    <DoubleAnimation Storyboard.TargetProperty="Opacity"
                                     From="0" To="1" Duration="0:0:0.4"
                                     DecelerationRatio="0.7"/>
                </Storyboard>
            </BeginStoryboard>
        </EventTrigger>
    </md:Card.Triggers>
    
    <StackPanel>
        <Image Source="/Assets/logo.png" Width="96" Height="96" Margin="0,0,0,24"/>
        <TextBlock Text="Welcome" Style="{StaticResource DisplayTextStyle}"/>
        <!-- Content -->
    </StackPanel>
</md:Card>
```

------

## 10) Data Binding Best Practices

### UpdateSourceTrigger

```xml
<!-- Real-time validation/filtering -->
<TextBox Text="{Binding SearchText, UpdateSourceTrigger=PropertyChanged}"/>

<!-- Default (LostFocus) for forms -->
<TextBox Text="{Binding ProjectName}"/>
```

### String Formatting

```xml
<TextBlock Text="{Binding CreatedUtc, StringFormat='yyyy-MM-dd HH:mm:ss'}"/>
<TextBlock Text="{Binding ProgressPercentage, StringFormat='{}{0:F1}%'}"/>
<TextBlock Text="{Binding Count, StringFormat='Total: {0:N0}'}"/>
```

### Binding Modes

```xml
<!-- Default: TwoWay for input controls, OneWay for display -->
<TextBox Text="{Binding Name}"/>  <!-- TwoWay by default -->
<TextBlock Text="{Binding Name}"/>  <!-- OneWay by default -->

<!-- Explicit modes -->
<TextBlock Text="{Binding Status, Mode=OneWay}"/>
<ComboBox SelectedItem="{Binding Selection, Mode=TwoWay}"/>
<TextBox Text="{Binding ReadOnlyProp, Mode=OneTime}"/>  <!-- Set once, never updates -->
```

### Fallback and Target Null Values

```xml
<!-- Show placeholder when binding fails or is null -->
<TextBlock Text="{Binding Description, FallbackValue='No description'}"/>
<TextBlock Text="{Binding Count, TargetNullValue='N/A'}"/>
```

------

## 11) Error Handling Patterns

### ViewModel Error Handling

```csharp
[RelayCommand]
private async Task LoadDataAsync()
{
    try
    {
        IsLoading = true;
        ErrorMessage = null;  // Clear previous errors
        
        var data = await _service.GetDataAsync();
        Items = new ObservableCollection<Item>(data);
        
        _logger.LogInformation("Loaded {Count} items", Items.Count);
    }
    catch (Exception ex)
    {
        _logger.LogError(ex, "Failed to load data");
        ErrorMessage = "Failed to load data. Please try again.";
        
        // For critical errors, show dialog via Dispatcher
        await Application.Current.Dispatcher.InvokeAsync(() =>
            MessageBox.Show(
                $"Failed to load data: {ex.Message}",
                "Error",
                MessageBoxButton.OK,
                MessageBoxImage.Error));
    }
    finally
    {
        IsLoading = false;
    }
}
```

### Display Errors in UI

```xml
<!-- Error message card -->
<md:Card Style="{StaticResource ErrorMessageCard}"
         Visibility="{Binding ErrorMessage, Converter={StaticResource NullToVisibilityConverter}}"
         Margin="0,0,0,16">
    <StackPanel Orientation="Horizontal">
        <md:PackIcon Kind="AlertCircle" 
                     Width="20" Height="20"
                     Foreground="{StaticResource ErrorBrush}"
                     Margin="0,0,12,0"/>
        <TextBlock Text="{Binding ErrorMessage}"
                   Style="{StaticResource BodyTextStyle}"
                   Foreground="{StaticResource ErrorBrush}"
                   TextWrapping="Wrap"/>
    </StackPanel>
</md:Card>
```

------

## 12) Testing Guidelines

### Unit Testing ViewModels

```csharp
public class ProjectHomeViewModelTests
{
    private readonly Mock<ILogger<ProjectHomeViewModel>> _loggerMock;
    private readonly Mock<IProjectService> _projectServiceMock;
    private readonly ProjectHomeViewModel _viewModel;

    public ProjectHomeViewModelTests()
    {
        _loggerMock = new Mock<ILogger<ProjectHomeViewModel>>();
        _projectServiceMock = new Mock<IProjectService>();
        _viewModel = new ProjectHomeViewModel(_loggerMock.Object, _projectServiceMock.Object);
    }

    [Fact]
    public async Task LoadDataAsync_ShouldPopulateItems()
    {
        // Arrange
        var expectedItems = new List<Item> { new Item { Name = "Test" } };
        _projectServiceMock
            .Setup(x => x.GetItemsAsync())
            .ReturnsAsync(expectedItems);

        // Act
        await _viewModel.LoadDataCommand.ExecuteAsync(null);

        // Assert
        Assert.Single(_viewModel.Items);
        Assert.Equal("Test", _viewModel.Items[0].Name);
    }
}
```

------

## 13) Building & Packaging for Distribution

### The 3-Part Build Process

**1. PowerShell Build Script (`build-installer.ps1`)**

Creates repeatable builds for multiple architectures:

```powershell
param(
    [ValidateSet('x86', 'x64', 'Both')]
    [string]$Platform = 'Both',
    
    [ValidateSet('Debug', 'Release')]
    [string]$Configuration = 'Release'
)

# Example usage:
# .\build-installer.ps1 -Platform Both -Configuration Release
```

**Key `dotnet publish` flags:**

```powershell
dotnet publish src\ShoutingIguana\ShoutingIguana.csproj `
  -c Release `
  -r win-x64 `                    # or win-x86
  -o publish\x64 `
  --self-contained true `          # Bundles .NET runtime
  /p:PublishSingleFile=false       # Keep files separate for installer
```

**2. Inno Setup Script (`Installer.iss`)**

Creates professional Windows installers from published files.

**Key sections:**

```inno
[Setup]
AppName=Shouting Iguana
AppVersion=1.0.0
PrivilegesRequired=admin              ; If you need registry access
ArchitecturesInstallIn64BitMode=x64   ; For x64 builds

[Files]
Source: "..\publish\{#Platform}\*"; DestDir: "{app}"; Flags: recursesubdirs

[Registry]
; Example: Add context menu entries
Root: HKCR; Subkey: "*\shell\ShoutingIguana\command"; ValueData: "{app}\ShoutingIguana.exe %*"

[Code]
; Check for .NET runtime and prompt download if missing
```

**3. Published Output Structure**

```
publish/
├── x64/                    # 64-bit build
│   └── ShoutingIguana.exe + dependencies
├── x86/                    # 32-bit build  
│   └── ShoutingIguana.exe + dependencies
└── installer/
    ├── ShoutingIguana-x64.exe     # Final installer for 64-bit
    └── ShoutingIguana-x86.exe     # Final installer for 32-bit
```

### How to Build

1. **Install Inno Setup 6** from https://jrsoftware.org/isdl.php

2. **Run build script:**
   ```powershell
   .\build-installer.ps1 -Platform Both -Configuration Release
   ```

3. **Output:** Installers in `publish\installer\`

### Key Advantages

- Professional installers with uninstall support
- Multi-architecture (x86/x64) with one command
- Self-contained (users don't need .NET installed)
- Repeatable builds for CI/CD
- Registry integration for context menus, file associations

------

## 14) Performance Best Practices

### UI Rendering

```xml
<!-- Improves text clarity -->
<Window UseLayoutRounding="True"
        TextOptions.TextFormattingMode="Display">
```

### DataGrid Virtualization

```xml
<!-- Enabled by default, but explicit for clarity -->
<DataGrid VirtualizingPanel.IsVirtualizing="True"
          VirtualizingPanel.VirtualizationMode="Recycling"
          EnableRowVirtualization="True"
          EnableColumnVirtualization="True"/>
```

### ObservableCollection Updates

```csharp
// Bad: Triggers UI update for each Add
foreach (var item in newItems)
{
    Items.Add(item);
}

// Good: Replace entire collection
Items = new ObservableCollection<Item>(newItems);
```

### Async/Await in Commands

```csharp
// Always use async Task for long-running operations
[RelayCommand]
private async Task LoadDataAsync()
{
    await Task.Run(() => _service.GetData());  // Don't block UI thread
}
```

------

## 15) Logging Best Practices

### Log Levels

```csharp
_logger.LogTrace("Entering method with param: {Param}", param);        // Development only
_logger.LogDebug("Cache hit for key: {Key}", key);                      // Development/staging
_logger.LogInformation("User {UserId} logged in", userId);              // Production
_logger.LogWarning("Retry attempt {Attempt} failed", attemptNum);       // Production
_logger.LogError(ex, "Failed to save project {ProjectId}", projectId); // Production
_logger.LogCritical(ex, "Database connection lost");                    // Production
```

### Structured Logging

```csharp
// Good: Structured with named parameters
_logger.LogInformation("Crawled {UrlCount} URLs in {Duration}ms", count, duration);

// Bad: String interpolation loses structure
_logger.LogInformation($"Crawled {count} URLs in {duration}ms");
```

### Exception Logging

```csharp
// Always include exception as first parameter
_logger.LogError(ex, "Failed to load project {ProjectId}", projectId);
```

------

## 16) Code Quality Checklist

Before committing code, verify:

### XAML
- [ ] All colors use StaticResource (no hardcoded hex values)
- [ ] All spacing uses StaticResource or multiples of 4px
- [ ] All text uses predefined styles
- [ ] Interactive elements have `AutomationProperties.Name`
- [ ] Interactive elements have `ToolTip`
- [ ] Headings have `AutomationProperties.HeadingLevel`
- [ ] Buttons use correct style (Primary/Secondary/Danger)
- [ ] No business logic in code-behind

### ViewModel
- [ ] Uses `[ObservableProperty]` and `[RelayCommand]`
- [ ] Implements `IDisposable` if subscribing to events
- [ ] Unsubscribes from events in `Dispose()`
- [ ] No UI types (Window, MessageBox, Brush, etc.)
- [ ] Async commands use `Task` return type
- [ ] Errors are logged with structured data
- [ ] Constructor only assigns dependencies (no logic)

### Services
- [ ] Has interface definition
- [ ] Registered in `App.xaml.cs` with correct lifetime
- [ ] Async methods have `Async` suffix
- [ ] Methods are testable (no static dependencies)
- [ ] Errors are logged with context

### General
- [ ] No compiler warnings
- [ ] No ReSharper/Rider warnings
- [ ] XML docs on public APIs
- [ ] Unit tests for business logic
- [ ] Follows naming conventions (PascalCase for public, _camelCase for private fields)

------

## 17) Common Pitfalls & Solutions

### Memory Leaks

**Problem:** ViewModels not disposed, events not unsubscribed

```csharp
// Bad
public class MyViewModel : ObservableObject
{
    public MyViewModel(IEventSource source)
    {
        source.EventOccurred += OnEvent;  // LEAK: Never unsubscribed
    }
}

// Good
public partial class MyViewModel : ObservableObject, IDisposable
{
    private readonly IEventSource _source;
    
    public MyViewModel(IEventSource source)
    {
        _source = source;
        _source.EventOccurred += OnEvent;
    }
    
    public void Dispose()
    {
        _source.EventOccurred -= OnEvent;  // Unsubscribe
    }
}
```

### UI Thread Blocking

**Problem:** Long-running operations on UI thread

```csharp
// Bad: Blocks UI
[RelayCommand]
private void LoadData()
{
    var data = _service.GetData();  // Synchronous, blocks UI
}

// Good: Async, non-blocking
[RelayCommand]
private async Task LoadDataAsync()
{
    var data = await Task.Run(() => _service.GetData());
}
```

### Hardcoded UI Values

**Problem:** Colors and spacing hardcoded in XAML

```xml
<!-- Bad -->
<TextBlock Foreground="#0078D4" FontSize="20" Margin="15,10,15,10"/>

<!-- Good -->
<TextBlock Foreground="{StaticResource PrimaryBrush}"
           Style="{StaticResource TitleTextStyle}"
           Margin="{StaticResource SpacingM}"/>
```

### Missing Accessibility

**Problem:** No screen reader support

```xml
<!-- Bad -->
<Button Content="⚙" Command="{Binding SettingsCommand}"/>

<!-- Good -->
<Button Command="{Binding SettingsCommand}"
        AutomationProperties.Name="Open Settings"
        ToolTip="Configure application settings">
    <md:PackIcon Kind="Cog" Width="20" Height="20"/>
</Button>
```

------

## 18) Resources & References

### Official Documentation
- [Material Design In XAML Toolkit](http://materialdesigninxaml.net/)
- [CommunityToolkit.Mvvm](https://learn.microsoft.com/en-us/dotnet/communitytoolkit/mvvm/)
- [Microsoft.Extensions.DependencyInjection](https://learn.microsoft.com/en-us/dotnet/core/extensions/dependency-injection)
- [Serilog](https://serilog.net/)

### WPF Best Practices
- [WPF Performance](https://learn.microsoft.com/en-us/dotnet/desktop/wpf/advanced/optimizing-performance-application-resources)
- [WPF Accessibility](https://learn.microsoft.com/en-us/dotnet/desktop/wpf/advanced/accessibility-best-practices)
- [WCAG 2.1 Guidelines](https://www.w3.org/WAI/WCAG21/quickref/)

### Internal Resources
- Project logs: `%LocalAppData%\ShoutingIguana\logs\`
- App settings: `%LocalAppData%\ShoutingIguana\appsettings.json`
- Project files: `.siguana` SQLite databases

------

**Remember:** Consistency is key. When in doubt, follow existing patterns in the codebase.
