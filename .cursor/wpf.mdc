---
description: This is for UI UX changes
alwaysApply: false
---
## Architecture Overview

### MVVM Pattern

We use the **MVVM (Model-View-ViewModel)** pattern with **CommunityToolkit.Mvvm** for clean separation of concerns.

**Key Components:**
- **Models**: Data entities in `ShoutingIguana.Core/Models/` (e.g., `Project`, `Finding`, `Url`)
- **Views**: XAML files in `src/ShoutingIguana/Views/` (e.g., `ProjectHomeView.xaml`)
- **ViewModels**: View logic in `src/ShoutingIguana/ViewModels/` (e.g., `ProjectHomeViewModel.cs`)

**ViewModel Pattern:**
```csharp
public partial class MyViewModel : ObservableObject
{
    // Use [ObservableProperty] for data binding
    [ObservableProperty]
    private string _myProperty = string.Empty;
    
    // Use [RelayCommand] for commands
    [RelayCommand]
    private async Task DoSomethingAsync()
    {
        // Implementation
    }
}
```

**View Setup:**
```xaml
<UserControl x:Class="ShoutingIguana.Views.MyView"
             Background="{StaticResource BackgroundBrush}">
    <Grid>
        <TextBlock Text="{Binding MyProperty}"/>
        <Button Command="{Binding DoSomethingCommand}" Content="Click Me"/>
    </Grid>
</UserControl>
```

### Dependency Injection

We use **Microsoft.Extensions.DependencyInjection** configured in `App.xaml.cs`:

**Service Lifetimes:**
- **Singleton**: Services that live for the app lifetime (e.g., `INavigationService`, `IToastService`)
- **Scoped**: Services tied to database operations (e.g., repositories)
- **Transient**: Views and ViewModels (created fresh each time)

**Example Registration:**
```csharp
services.AddSingleton<INavigationService, NavigationService>();
services.AddScoped<IProjectRepository, ProjectRepository>();
services.AddTransient<MainViewModel>();
```

**Injecting Dependencies:**
```csharp
public partial class MyViewModel : ObservableObject
{
    private readonly ILogger<MyViewModel> _logger;
    private readonly INavigationService _navigationService;
    
    public MyViewModel(
        ILogger<MyViewModel> logger,
        INavigationService navigationService)
    {
        _logger = logger;
        _navigationService = navigationService;
    }
}
```

### Navigation System

Navigation is managed by `INavigationService` in `src/ShoutingIguana/Services/NavigationService.cs`.

**Navigate to a View:**
```csharp
_navigationService.NavigateTo<ProjectHomeView>();
```

The navigation service:
1. Creates the view using the DI container
2. Disposes previous view's DataContext if it implements `IDisposable`
3. Raises `NavigationRequested` event (handled by `MainViewModel`)

**Disposal Pattern:**
```csharp
public partial class MyViewModel : ObservableObject, IDisposable
{
    private bool _disposed;
    
    public void Dispose()
    {
        if (_disposed) return;
        
        // Unsubscribe from events
        _someService.SomeEvent -= OnSomeEvent;
        
        _disposed = true;
    }
}
```

### Database Architecture

We use **Entity Framework Core** with **SQLite**, one database file per project:

**Project Structure:**
- Each project has its own `.db` file in `%AppData%\ShoutingIguana\projects\`
- `ProjectDbContextProvider` manages switching between project databases
- Repositories use scoped `IShoutingIguanaDbContext` for operations

**Using Repositories:**
```csharp
// Create a scope for database operations
using var scope = _serviceProvider.CreateScope();
var projectRepo = scope.ServiceProvider.GetRequiredService<IProjectRepository>();

// Perform operations
var project = await projectRepo.GetByIdAsync(projectId);
await projectRepo.UpdateAsync(project);
```

**Why Scoped?**
- Database contexts must not be shared across threads
- Scoped lifetime ensures each operation gets a fresh context
- Automatic disposal when scope ends

### Plugin System

Plugins are in `ShoutingIguana.Plugins/` and implement `IPlugin` from the SDK:

**Plugin Interface:**
```csharp
[Plugin(
    Name = "My Plugin",
    Description = "Does something cool",
    Category = PluginCategory.Analysis)]
public class MyPlugin : IPlugin
{
    public async Task<IEnumerable<PluginBase>> CreateTasksAsync(IHostContext context)
    {
        // Return analysis tasks
    }
}
```

Plugins are discovered and loaded automatically by `PluginRegistry` on startup.

---

## Design System

### Core Principles

Our UI follows **Windows 11 design language**:
- Clean, minimal, and modern
- Ample whitespace and breathing room
- Subtle shadows and rounded corners
- Smooth animations and transitions
- High contrast for accessibility

**Single Source of Truth:** All styles are defined in `src/ShoutingIguana/Styles/Styles.xaml`.

### Color Palette

**Primary Colors:**
```xaml
{StaticResource PrimaryBrush}      <!-- #0078D4 - Main brand color -->
{StaticResource PrimaryLightBrush} <!-- #2B88D8 - Hover states -->
{StaticResource PrimaryDarkBrush}  <!-- #005A9E - Active states -->
```

**Background Colors:**
```xaml
{StaticResource BackgroundBrush}       <!-- #F3F3F3 - Page background -->
{StaticResource SurfaceBrush}          <!-- #FFFFFF - Card/panel background -->
{StaticResource SurfaceVariantBrush}   <!-- #FAFAFA - Subtle variation -->
{StaticResource SurfaceAltBrush}       <!-- #F5F5F5 - Alternating rows -->
```

**Text Colors (WCAG AA compliant):**
```xaml
{StaticResource TextPrimaryBrush}   <!-- #1F1F1F - Primary text -->
{StaticResource TextSecondaryBrush} <!-- #5A5A5A - Secondary text -->
{StaticResource TextTertiaryBrush}  <!-- #757575 - Tertiary text -->
```

**Semantic Colors:**
```xaml
{StaticResource SuccessBrush}  <!-- #107C10 - Success states -->
{StaticResource WarningBrush}  <!-- #FFB900 - Warning states -->
{StaticResource ErrorBrush}    <!-- #D13438 - Error states -->
{StaticResource InfoBrush}     <!-- #0078D4 - Informational -->
```

**Borders & Dividers:**
```xaml
{StaticResource BorderBrush}      <!-- #E0E0E0 - Standard borders -->
{StaticResource BorderLightBrush} <!-- #EEEEEE - Subtle borders -->
{StaticResource DividerBrush}     <!-- #E0E0E0 - Separators -->
```

### Spacing System

We use a **4px base unit** for consistent spacing:

```xaml
{StaticResource SpacingXs}   <!-- 4px  - Minimal spacing -->
{StaticResource SpacingS}    <!-- 8px  - Small spacing -->
{StaticResource SpacingM}    <!-- 16px - Medium spacing (default) -->
{StaticResource SpacingL}    <!-- 24px - Large spacing -->
{StaticResource SpacingXl}   <!-- 32px - Extra large -->
{StaticResource SpacingXxl}  <!-- 48px - Maximum spacing -->
```

**Usage:**
```xaml
<!-- As Thickness (all sides) -->
<Border Padding="{StaticResource SpacingM}">

<!-- As Double (specific sides) -->
<StackPanel Margin="0,0,0,{StaticResource SpacingMValue}">
```

### Typography

We use **Segoe UI Variable** fonts for a modern Windows 11 appearance:

**Text Styles:**
```xaml
<!-- Display (28px, SemiBold) - Page titles -->
<TextBlock Style="{StaticResource DisplayTextStyle}" 
           Text="Page Title"/>

<!-- Title (20px, SemiBold) - Section headers -->
<TextBlock Style="{StaticResource TitleTextStyle}" 
           Text="Section Header"/>

<!-- Subtitle (16px, Medium) - Subsection headers -->
<TextBlock Style="{StaticResource SubtitleTextStyle}" 
           Text="Subsection"/>

<!-- Body (14px, Normal) - Standard text -->
<TextBlock Style="{StaticResource BodyTextStyle}" 
           Text="Body text"/>

<!-- Body Emphasis (14px, Medium) - Emphasized body -->
<TextBlock Style="{StaticResource BodyEmphasisTextStyle}" 
           Text="Important text"/>

<!-- Caption (12px, Normal) - Metadata -->
<TextBlock Style="{StaticResource CaptionTextStyle}" 
           Text="Metadata"/>

<!-- Caption Light (12px, Light) - De-emphasized -->
<TextBlock Style="{StaticResource CaptionLightTextStyle}" 
           Text="Subtle info"/>
```

**Hierarchy Example:**
```xaml
<StackPanel>
    <!-- Page title -->
    <TextBlock Style="{StaticResource DisplayTextStyle}" 
               Text="Findings"
               Margin="0,0,0,8"/>
    
    <!-- Subtitle -->
    <TextBlock Style="{StaticResource BodyTextStyle}" 
               Foreground="{StaticResource TextSecondaryBrush}"
               Text="Issues discovered during crawl"/>
</StackPanel>
```

### Icon System

We use **Segoe MDL2 Assets** (Windows built-in icons) for consistent iconography:

**Common Icons:**
```xaml
{StaticResource Icon.Play}       <!-- &#xE768; -->
{StaticResource Icon.Stop}       <!-- &#xEA39; -->
{StaticResource Icon.Pause}      <!-- &#xE769; -->
{StaticResource Icon.Refresh}    <!-- &#xE72C; -->
{StaticResource Icon.Home}       <!-- &#xE80F; -->
{StaticResource Icon.Settings}   <!-- &#xE713; -->
{StaticResource Icon.Search}     <!-- &#xE721; -->
{StaticResource Icon.Export}     <!-- &#xE898; -->
{StaticResource Icon.Save}       <!-- &#xE74E; -->
{StaticResource Icon.Close}      <!-- &#xE711; -->
{StaticResource Icon.Delete}     <!-- &#xE74D; -->
{StaticResource Icon.Success}    <!-- &#xE73E; -->
{StaticResource Icon.Warning}    <!-- &#xE7BA; -->
{StaticResource Icon.Error}      <!-- &#xE783; -->
{StaticResource Icon.Info}       <!-- &#xE946; -->
```

**Usage:**
```xaml
<!-- Simple icon -->
<TextBlock Text="{StaticResource Icon.Search}"
           Style="{StaticResource Icon}"/>

<!-- Icon with custom size/color -->
<TextBlock Text="{StaticResource Icon.Play}"
           FontFamily="Segoe MDL2 Assets"
           FontSize="20"
           Foreground="{StaticResource PrimaryBrush}"/>

<!-- Icon in button -->
<Button Style="{StaticResource PrimaryButton}">
    <StackPanel Orientation="Horizontal">
        <TextBlock Text="{StaticResource Icon.Play}"
                   Style="{StaticResource Icon}"
                   Margin="0,0,8,0"/>
        <TextBlock Text="Start Crawl"/>
    </StackPanel>
</Button>
```

### Component Library

#### Buttons

**Primary Button** - Main actions:
```xaml
<Button Content="Start Crawl"
        Command="{Binding StartCrawlCommand}"
        Style="{StaticResource PrimaryButton}"/>
```

**Secondary Button** - Alternative actions:
```xaml
<Button Content="Cancel"
        Command="{Binding CancelCommand}"
        Style="{StaticResource SecondaryButton}"/>
```

**Danger Button** - Destructive actions:
```xaml
<Button Content="Delete Project"
        Command="{Binding DeleteCommand}"
        Style="{StaticResource DangerButton}"/>
```

**Large Button** - Prominent actions:
```xaml
<Button Content="Get Started"
        Command="{Binding StartCommand}"
        Style="{StaticResource LargeButton}"/>
```

#### Cards

**Standard Card** - Content containers:
```xaml
<Border Style="{StaticResource Card}">
    <StackPanel>
        <TextBlock Text="Card Title" 
                   Style="{StaticResource TitleTextStyle}"/>
        <TextBlock Text="Card content goes here"/>
    </StackPanel>
</Border>
```

**Metric Card** - Dashboard statistics:
```xaml
<Border Style="{StaticResource MetricCard}">
    <StackPanel>
        <TextBlock Text="1,234" 
                   Style="{StaticResource DisplayTextStyle}"
                   Foreground="{StaticResource PrimaryBrush}"/>
        <TextBlock Text="URLs Crawled" 
                   Style="{StaticResource CaptionTextStyle}"/>
    </StackPanel>
</Border>
```

**Info Card** - Notices and hints:
```xaml
<Border Style="{StaticResource InfoCard}">
    <StackPanel Orientation="Horizontal">
        <TextBlock Text="{StaticResource Icon.Info}"
                   Style="{StaticResource Icon}"
                   Margin="0,0,12,0"/>
        <TextBlock Text="Helpful information here"
                   TextWrapping="Wrap"/>
    </StackPanel>
</Border>
```

#### Input Controls

**Text Box:**
```xaml
<TextBox Text="{Binding ProjectName, UpdateSourceTrigger=PropertyChanged}"
         Style="{StaticResource ModernTextBox}">
    <TextBox.Tag>Placeholder text</TextBox.Tag>
</TextBox>
```

**Combo Box:**
```xaml
<ComboBox SelectedItem="{Binding SelectedOption}"
          Style="{StaticResource ModernComboBox}">
    <ComboBoxItem>Option 1</ComboBoxItem>
    <ComboBoxItem>Option 2</ComboBoxItem>
</ComboBox>
```

**Check Box:**
```xaml
<CheckBox Content="Enable this feature"
          IsChecked="{Binding IsEnabled}"/>
```

#### Data Grid

```xaml
<DataGrid ItemsSource="{Binding Items}"
          SelectedItem="{Binding SelectedItem}"
          Style="{StaticResource ModernDataGrid}">
    <DataGrid.Columns>
        <DataGridTextColumn Header="Name" 
                            Binding="{Binding Name}" 
                            Width="*"/>
        <DataGridTextColumn Header="Status" 
                            Binding="{Binding Status}" 
                            Width="150"/>
    </DataGrid.Columns>
</DataGrid>
```

#### Progress Bar

```xaml
<!-- Determinate progress -->
<ProgressBar Value="{Binding Progress}"
             Maximum="100"
             Style="{StaticResource ModernProgressBar}"/>

<!-- Indeterminate progress -->
<ProgressBar IsIndeterminate="True"
             Style="{StaticResource ModernProgressBar}"/>

<!-- With percentage display -->
<Grid>
    <StackPanel>
        <Grid Margin="0,0,0,8">
            <TextBlock Text="Overall Progress"
                       Style="{StaticResource TitleTextStyle}"
                       FontSize="18"/>
            <TextBlock Text="{Binding ProgressPercentage, StringFormat={}{0:F1}%}"
                       Style="{StaticResource DisplayTextStyle}"
                       FontSize="36"
                       HorizontalAlignment="Right"
                       Foreground="{StaticResource PrimaryBrush}"/>
        </Grid>
        <ProgressBar Value="{Binding ProgressPercentage}"
                     Maximum="100"
                     Height="16"
                     Style="{StaticResource ModernProgressBar}"/>
    </StackPanel>
</Grid>
```

#### Tab Control

```xaml
<!-- Basic TabControl -->
<TabControl ItemsSource="{Binding Tabs}"
            SelectedItem="{Binding SelectedTab}"
            Style="{StaticResource StandardTabControl}">
    <TabControl.ItemTemplate>
        <DataTemplate>
            <TextBlock Text="{Binding TabHeader}"/>
        </DataTemplate>
    </TabControl.ItemTemplate>
    <TabControl.ContentTemplate>
        <DataTemplate>
            <!-- Tab content here -->
        </DataTemplate>
    </TabControl.ContentTemplate>
</TabControl>

<!-- Tab with Icons and Badges -->
<TabControl ItemsSource="{Binding Tabs}"
            SelectedItem="{Binding SelectedTab}"
            Style="{StaticResource StandardTabControl}">
    <TabControl.ItemTemplate>
        <DataTemplate>
            <StackPanel Orientation="Horizontal" Margin="12,0">
                <TextBlock Text="{Binding TabHeader}" 
                           VerticalAlignment="Center"
                           Margin="0,0,8,0"
                           FontWeight="Medium"/>
                <!-- Error count badge -->
                <Border Background="{StaticResource ErrorBrush}" 
                        CornerRadius="10" 
                        Padding="6,2"
                        VerticalAlignment="Center"
                        Visibility="{Binding ErrorCount, Converter={StaticResource Int32ToVisibilityConverter}}">
                    <TextBlock Text="{Binding ErrorCount}" 
                               Foreground="White" 
                               FontSize="10"
                               FontWeight="Bold"/>
                </Border>
            </StackPanel>
        </DataTemplate>
    </TabControl.ItemTemplate>
    <TabControl.ContentTemplate>
        <DataTemplate>
            <Grid Margin="16">
                <!-- Tab content here -->
            </Grid>
        </DataTemplate>
    </TabControl.ContentTemplate>
</TabControl>
```

#### Password Box

```xaml
<StackPanel>
    <TextBlock Text="Password" 
               Style="{StaticResource FormFieldLabel}"
               Margin="0,0,0,8"/>
    <PasswordBox x:Name="PasswordBox"
                 Style="{StaticResource ModernPasswordBox}"
                 TabIndex="0"
                 AutomationProperties.Name="Password"/>
    <TextBlock Text="Password is encrypted using Windows DPAPI and stored securely."
               Style="{StaticResource HelperText}"/>
</StackPanel>
```

#### Advanced Input Patterns

**Multiline TextBox:**
```xaml
<TextBox Text="{Binding Notes, UpdateSourceTrigger=PropertyChanged}"
         Style="{StaticResource ModernTextBox}"
         AcceptsReturn="True"
         TextWrapping="Wrap"
         VerticalScrollBarVisibility="Auto"
         Height="100"
         VerticalContentAlignment="Top"/>
```

**ComboBox with MaxDropDownHeight:**
```xaml
<ComboBox SelectedItem="{Binding SelectedOption}"
          Style="{StaticResource ModernComboBox}"
          MaxDropDownHeight="300">
    <ComboBoxItem>Option 1</ComboBoxItem>
    <ComboBoxItem>Option 2</ComboBoxItem>
    <ComboBoxItem>Option 3</ComboBoxItem>
</ComboBox>
```

**CheckBox with Wrapping Text:**
```xaml
<CheckBox IsChecked="{Binding IsEnabled}"
          FontSize="14"
          Margin="0">
    <TextBlock Text="Enable this feature with a long description that wraps nicely" 
               TextWrapping="Wrap"/>
</CheckBox>
```

**Browse Button + Read-Only TextBox Pattern:**
```xaml
<Grid>
    <Grid.ColumnDefinitions>
        <ColumnDefinition Width="*"/>
        <ColumnDefinition Width="Auto"/>
    </Grid.ColumnDefinitions>
    <TextBox Grid.Column="0"
             Text="{Binding FilePath, UpdateSourceTrigger=PropertyChanged}"
             Style="{StaticResource ModernTextBox}"
             IsReadOnly="True"
             Margin="0,0,8,0"/>
    <Button Grid.Column="1"
            Content="Browse..."
            Style="{StaticResource SecondaryButton}"
            Command="{Binding BrowseCommand}"/>
</Grid>
```

**Conditional Enable/Disable:**
```xaml
<StackPanel IsEnabled="{Binding IsProxyEnabled}">
    <TextBox Text="{Binding ProxyServer}" Style="{StaticResource ModernTextBox}"/>
    <TextBox Text="{Binding ProxyPort}" Style="{StaticResource ModernTextBox}"/>
</StackPanel>
```

#### GridSplitter

```xaml
<Grid>
    <Grid.RowDefinitions>
        <RowDefinition Height="2*" MinHeight="350" MaxHeight="800"/>
        <RowDefinition Height="Auto"/>
        <RowDefinition Height="1*" MinHeight="200"/>
    </Grid.RowDefinitions>
    
    <!-- Top panel -->
    <Border Grid.Row="0" Style="{StaticResource Card}">
        <!-- Content -->
    </Border>
    
    <!-- Splitter -->
    <GridSplitter Grid.Row="1" 
                  Height="8" 
                  HorizontalAlignment="Stretch" 
                  Style="{StaticResource ModernGridSplitter}"
                  Cursor="SizeNS"
                  Margin="0,8"
                  AutomationProperties.Name="Resize Findings and Details Panels"/>
    
    <!-- Bottom panel -->
    <Border Grid.Row="2" Style="{StaticResource Card}">
        <!-- Content -->
    </Border>
</Grid>
```

#### Advanced Card Patterns

**Metric Card with Colored Accent Border:**
```xaml
<!-- Success metric -->
<Border Background="{StaticResource SurfaceBrush}"
        CornerRadius="8"
        Padding="20"
        BorderBrush="{StaticResource SuccessBrush}"
        BorderThickness="0,0,0,4"
        SnapsToDevicePixels="True"
        AutomationProperties.Name="URLs Crawled Metric"
        AutomationProperties.LiveSetting="Polite">
    <Border.Effect>
        <DropShadowEffect Color="#000000" BlurRadius="4" ShadowDepth="1" Opacity="0.06"/>
    </Border.Effect>
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>
        
        <!-- Label with icon -->
        <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,12">
            <Border Background="{StaticResource SuccessBrush}"
                    Width="32" Height="32"
                    CornerRadius="6"
                    Margin="0,0,10,0">
                <TextBlock Text="{StaticResource Icon.CheckCircle}"
                           Style="{StaticResource Icon}"
                           Foreground="White"/>
            </Border>
            <TextBlock Text="URLs Crawled"
                       Style="{StaticResource BodyTextStyle}"
                       FontWeight="SemiBold"
                       VerticalAlignment="Center"/>
        </StackPanel>
        
        <!-- Value -->
        <TextBlock Grid.Row="1"
                   Text="{Binding UrlsCrawled}"
                   Style="{StaticResource DisplayTextStyle}"
                   FontSize="36"
                   FontWeight="Bold"
                   Foreground="{StaticResource SuccessBrush}"/>
    </Grid>
</Border>

<!-- Error metric -->
<Border Background="{StaticResource SurfaceBrush}"
        CornerRadius="8"
        Padding="20"
        BorderBrush="{StaticResource ErrorBrush}"
        BorderThickness="0,0,0,4"
        SnapsToDevicePixels="True">
    <Border.Effect>
        <DropShadowEffect Color="#000000" BlurRadius="4" ShadowDepth="1" Opacity="0.06"/>
    </Border.Effect>
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>
        
        <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,12">
            <Border Background="{StaticResource ErrorBrush}"
                    Width="32" Height="32"
                    CornerRadius="6"
                    Margin="0,0,10,0">
                <TextBlock Text="{StaticResource Icon.AlertCircle}"
                           Style="{StaticResource Icon}"
                           Foreground="White"/>
            </Border>
            <TextBlock Text="Errors"
                       Style="{StaticResource BodyTextStyle}"
                       FontWeight="SemiBold"
                       VerticalAlignment="Center"/>
        </StackPanel>
        
        <TextBlock Grid.Row="1"
                   Text="{Binding ErrorCount}"
                   Style="{StaticResource DisplayTextStyle}"
                   FontSize="36"
                   FontWeight="Bold"
                   Foreground="{StaticResource ErrorBrush}"/>
    </Grid>
</Border>
```

**Dashboard Metric Grid:**
```xaml
<Grid Margin="0,0,0,24">
    <Grid.ColumnDefinitions>
        <ColumnDefinition Width="*"/>
        <ColumnDefinition Width="16"/>
        <ColumnDefinition Width="*"/>
        <ColumnDefinition Width="16"/>
        <ColumnDefinition Width="*"/>
    </Grid.ColumnDefinitions>
    
    <!-- Metric Card 1 -->
    <Border Grid.Column="0" Style="{StaticResource MetricCard}" 
            BorderBrush="{StaticResource SuccessBrush}" BorderThickness="0,0,0,4">
        <!-- Content -->
    </Border>
    
    <!-- Metric Card 2 -->
    <Border Grid.Column="2" Style="{StaticResource MetricCard}" 
            BorderBrush="{StaticResource InfoBrush}" BorderThickness="0,0,0,4">
        <!-- Content -->
    </Border>
    
    <!-- Metric Card 3 -->
    <Border Grid.Column="4" Style="{StaticResource MetricCard}" 
            BorderBrush="{StaticResource PrimaryBrush}" BorderThickness="0,0,0,4">
        <!-- Content -->
    </Border>
</Grid>
```

#### Dialog Windows

**Standard Dialog Pattern:**
```xaml
<Window x:Class="ShoutingIguana.Views.SettingsDialog"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Settings"
        Height="650"
        Width="900"
        MinHeight="550"
        MinWidth="800"
        WindowStartupLocation="CenterOwner"
        Background="{StaticResource BackgroundBrush}"
        Foreground="{StaticResource TextPrimaryBrush}"
        UseLayoutRounding="True"
        TextOptions.TextFormattingMode="Display"
        ResizeMode="CanResize">
    
    <Grid Margin="0" KeyboardNavigation.TabNavigation="Cycle">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>  <!-- Header -->
            <RowDefinition Height="*"/>      <!-- Content -->
            <RowDefinition Height="Auto"/>  <!-- Footer/Actions -->
        </Grid.RowDefinitions>

        <!-- Header -->
        <Border Grid.Row="0"
                Background="{StaticResource SurfaceBrush}"
                BorderBrush="{StaticResource BorderLightBrush}"
                BorderThickness="0,0,0,1"
                Padding="24,20">
            <StackPanel Orientation="Horizontal">
                <Border Background="{StaticResource PrimaryBrush}"
                        Width="44" Height="44"
                        CornerRadius="8"
                        Margin="0,0,16,0">
                    <TextBlock Text="{StaticResource Icon.Settings}"
                               Style="{StaticResource Icon}"
                               FontSize="22"
                               Foreground="White"/>
                </Border>
                <StackPanel VerticalAlignment="Center">
                    <TextBlock Text="Settings"
                               Style="{StaticResource TitleTextStyle}"
                               Margin="0"/>
                    <TextBlock Text="Configure application behavior and preferences"
                               Style="{StaticResource BodyTextStyle}"
                               Foreground="{StaticResource TextSecondaryBrush}"
                               Margin="0,4,0,0"/>
                </StackPanel>
            </StackPanel>
        </Border>

        <!-- Content (usually a TabControl or ScrollViewer) -->
        <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto">
            <!-- Your content here -->
        </ScrollViewer>

        <!-- Action Buttons -->
        <Border Grid.Row="2"
                Background="{StaticResource SurfaceBrush}"
                BorderBrush="{StaticResource BorderLightBrush}"
                BorderThickness="0,1,0,0"
                Padding="24,16">
            <Grid>
                <Button Command="{Binding RestoreDefaultsCommand}"
                        Style="{StaticResource SecondaryButton}"
                        HorizontalAlignment="Left"
                        Content="Restore Defaults"/>
                
                <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                    <Button Content="Cancel"
                            Command="{Binding CancelCommand}"
                            Style="{StaticResource SecondaryButton}"
                            Margin="0,0,12,0"
                            IsCancel="True"
                            ToolTip="Close without saving changes (Esc)"/>
                    <Button Content="Save Settings"
                            Command="{Binding SaveCommand}"
                            Style="{StaticResource PrimaryButton}"
                            Height="48"
                            Padding="32,12"
                            IsDefault="True"
                            ToolTip="Save changes and close (Enter)"/>
                </StackPanel>
            </Grid>
        </Border>
    </Grid>
</Window>
```

**Dialog Best Practices:**
- Set `WindowStartupLocation="CenterOwner"` to center on parent window
- Use `IsDefault="True"` on primary action button (Enter key)
- Use `IsCancel="True"` on cancel button (Escape key)
- Set `KeyboardNavigation.TabNavigation="Cycle"` at window level
- Use three-row layout: Header, Content, Footer
- Always provide header with icon and description
- Use sequential TabIndex values within each section

#### Data Triggers and Dynamic Styling

**Severity Badge with DataTriggers:**
```xaml
<UserControl.Resources>
    <!-- Severity Badge Selector -->
    <Style x:Key="SeverityBadgeStyle" TargetType="Border">
        <Setter Property="CornerRadius" Value="4"/>
        <Setter Property="Padding" Value="8,4"/>
        <Setter Property="HorizontalAlignment" Value="Stretch"/>
        <Style.Triggers>
            <DataTrigger Binding="{Binding Severity}" Value="{x:Static sdk:Severity.Error}">
                <Setter Property="Background" Value="{StaticResource ErrorBackgroundBrush}"/>
            </DataTrigger>
            <DataTrigger Binding="{Binding Severity}" Value="{x:Static sdk:Severity.Warning}">
                <Setter Property="Background" Value="{StaticResource WarningBackgroundBrush}"/>
            </DataTrigger>
            <DataTrigger Binding="{Binding Severity}" Value="{x:Static sdk:Severity.Info}">
                <Setter Property="Background" Value="{StaticResource InfoBackgroundBrush}"/>
            </DataTrigger>
        </Style.Triggers>
    </Style>
    
    <Style x:Key="SeverityTextStyle" TargetType="TextBlock">
        <Setter Property="FontWeight" Value="Bold"/>
        <Setter Property="FontSize" Value="12"/>
        <Setter Property="HorizontalAlignment" Value="Center"/>
        <Style.Triggers>
            <DataTrigger Binding="{Binding Severity}" Value="{x:Static sdk:Severity.Error}">
                <Setter Property="Foreground" Value="{StaticResource ErrorBrush}"/>
            </DataTrigger>
            <DataTrigger Binding="{Binding Severity}" Value="{x:Static sdk:Severity.Warning}">
                <Setter Property="Foreground" Value="{StaticResource WarningBrush}"/>
            </DataTrigger>
            <DataTrigger Binding="{Binding Severity}" Value="{x:Static sdk:Severity.Info}">
                <Setter Property="Foreground" Value="{StaticResource InfoBrush}"/>
            </DataTrigger>
        </Style.Triggers>
    </Style>
</UserControl.Resources>

<!-- Usage in DataGrid -->
<DataGrid.Columns>
    <DataGridTemplateColumn Header="Severity" Width="Auto" MinWidth="100">
        <DataGridTemplateColumn.CellTemplate>
            <DataTemplate>
                <Border Style="{StaticResource SeverityBadgeStyle}">
                    <TextBlock Text="{Binding Severity}" 
                               Style="{StaticResource SeverityTextStyle}"/>
                </Border>
            </DataTemplate>
        </DataGridTemplateColumn.CellTemplate>
    </DataGridTemplateColumn>
</DataGrid.Columns>
```

**Conditional Visibility:**
```xaml
<!-- Show when paused -->
<Border Background="{StaticResource WarningBrush}"
        CornerRadius="4"
        Padding="8,4"
        Visibility="{Binding IsPaused, Converter={StaticResource BooleanToVisibilityConverter}}">
    <TextBlock Text="PAUSED" FontWeight="Bold" Foreground="White"/>
</Border>

<!-- Show when has open project -->
<MenuItem Header="_Export"
          Visibility="{Binding HasOpenProject, Converter={StaticResource BooleanToVisibilityConverter}}">
    <!-- Content -->
</MenuItem>

<!-- Show when count is zero -->
<StackPanel Style="{StaticResource EmptyStateContainer}"
            Visibility="{Binding Items.Count, Converter={StaticResource InverseInt32ToVisibilityConverter}}">
    <!-- Empty state content -->
</StackPanel>
```

#### Input Bindings for Keyboard Shortcuts

**UserControl Level:**
```xaml
<UserControl.InputBindings>
    <KeyBinding Key="C" Modifiers="Control" Command="{Binding SelectedTab.CopyUrlCommand}"/>
    <KeyBinding Key="C" Modifiers="Control+Shift" Command="{Binding SelectedTab.CopyMessageCommand}"/>
    <KeyBinding Key="Enter" Modifiers="Control" Command="{Binding SelectedTab.OpenInBrowserCommand}"/>
</UserControl.InputBindings>
```

**Window Level:**
```xaml
<Window.InputBindings>
    <!-- File -->
    <KeyBinding Key="N" Modifiers="Control" Command="{Binding NewProjectCommand}"/>
    <KeyBinding Key="O" Modifiers="Control" Command="{Binding OpenProjectCommand}"/>
    <KeyBinding Key="W" Modifiers="Control" Command="{Binding CloseProjectCommand}"/>
    <KeyBinding Key="S" Modifiers="Control" Command="{Binding SaveProjectCommand}"/>
    <KeyBinding Key="E" Modifiers="Control" Command="{Binding ExportToExcelCommand}"/>
    
    <!-- View -->
    <KeyBinding Key="D1" Modifiers="Control" Command="{Binding NavigateToProjectHomeCommand}"/>
    <KeyBinding Key="D2" Modifiers="Control" Command="{Binding NavigateToCrawlDashboardCommand}"/>
    <KeyBinding Key="D3" Modifiers="Control" Command="{Binding NavigateToFindingsCommand}"/>
    
    <!-- Actions -->
    <KeyBinding Key="F5" Command="{Binding RefreshCommand}"/>
    <KeyBinding Key="F6" Command="{Binding StartCrawlCommand}"/>
    <KeyBinding Key="F8" Command="{Binding StopCrawlCommand}"/>
</Window.InputBindings>
```

---

## UI/UX Guidelines

### Enterprise Windows 11 Look & Feel

**Key Characteristics:**
1. **Rounded corners** - 8px/12px for cards, 4px/6px for inputs and small elements
2. **Subtle shadows** - DropShadowEffect with low opacity (0.06-0.15)
3. **Fluent animations** - 0.2-0.4s duration with easing (DecelerationRatio 0.7-0.8)
4. **Ample padding** - Follow spacing system (16-24px for cards)
5. **Consistent alignment** - Use Grid/StackPanel effectively
6. **Crisp rendering** - Always use SnapsToDevicePixels="True" on borders
7. **Modern typography** - Segoe UI Variable fonts with appropriate weights

**Rendering Best Practices:**
```xaml
<!-- Window level -->
<Window UseLayoutRounding="True"
        TextOptions.TextFormattingMode="Display"
        SnapsToDevicePixels="True">
    
    <!-- All borders and cards -->
    <Border SnapsToDevicePixels="True"
            Background="{StaticResource SurfaceBrush}"
            CornerRadius="8">
        <!-- Content -->
    </Border>
</Window>
```

**Standard Page Header Pattern:**
```xaml
<Border Grid.Row="0"
        Background="{StaticResource SurfaceBrush}"
        CornerRadius="8"
        Padding="24"
        Margin="0,0,0,24"
        SnapsToDevicePixels="True">
    <Border.Effect>
        <DropShadowEffect Color="#000000" BlurRadius="8" ShadowDepth="2" Opacity="0.06"/>
    </Border.Effect>
    
    <Grid>
        <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
            <!-- Icon container -->
            <Border Background="{StaticResource PrimaryBrush}"
                    Width="44" Height="44"
                    CornerRadius="8"
                    Margin="0,0,16,0">
                <TextBlock Text="{StaticResource Icon.Search}"
                           Style="{StaticResource Icon}"
                           FontSize="22"
                           Foreground="White"/>
            </Border>
            
            <!-- Title and description -->
            <StackPanel VerticalAlignment="Center">
                <TextBlock Text="Findings"
                           Style="{StaticResource DisplayTextStyle}"
                           FontSize="24"
                           Margin="0"
                           AutomationProperties.HeadingLevel="Level1"/>
                <TextBlock Text="Issues and insights discovered during crawl"
                           Style="{StaticResource BodyTextStyle}"
                           Foreground="{StaticResource TextSecondaryBrush}"
                           Margin="0,4,0,0"/>
            </StackPanel>
        </StackPanel>
        
        <!-- Optional toolbar on right -->
        <StackPanel Style="{StaticResource ToolbarPanel}">
            <Button Command="{Binding RefreshCommand}"
                    Style="{StaticResource SecondaryButton}"/>
            <Button Command="{Binding ExportCommand}"
                    Style="{StaticResource PrimaryButton}"
                    Margin="6,0,0,0"/>
        </StackPanel>
    </Grid>
</Border>
```

**Page Structure with Animation:**
```xaml
<Grid Margin="{StaticResource SpacingL}" KeyboardNavigation.TabNavigation="Local">
    <!-- Add standard page load animation -->
    <Grid.RenderTransform>
        <TranslateTransform/>
    </Grid.RenderTransform>
    <Grid.Triggers>
        <EventTrigger RoutedEvent="Loaded">
            <BeginStoryboard>
                <Storyboard>
                    <DoubleAnimation Storyboard.TargetProperty="(UIElement.RenderTransform).(TranslateTransform.Y)"
                                     From="20" To="0" Duration="0:0:0.4"
                                     DecelerationRatio="0.7"/>
                    <DoubleAnimation Storyboard.TargetProperty="Opacity"
                                     From="0" To="1" Duration="0:0:0.4"
                                     DecelerationRatio="0.7"/>
                </Storyboard>
            </BeginStoryboard>
        </EventTrigger>
    </Grid.Triggers>
    
    <Grid.RowDefinitions>
        <RowDefinition Height="Auto"/> <!-- Header -->
        <RowDefinition Height="*"/>    <!-- Content -->
    </Grid.RowDefinitions>
    
    <!-- Header -->
    <Border Grid.Row="0" Style="{StaticResource Card}" Margin="0,0,0,24">
        <!-- Use standard header pattern above -->
    </Border>
    
    <!-- Content -->
    <Border Grid.Row="1" Style="{StaticResource Card}">
        <!-- Your content here -->
    </Border>
</Grid>
```

**ScrollViewer with MaxWidth for Readability:**
```xaml
<ScrollViewer VerticalScrollBarVisibility="Auto" Padding="24,20">
    <StackPanel MaxWidth="750">
        <!-- Form content with optimal reading width -->
        <Border Background="{StaticResource SurfaceBrush}"
                CornerRadius="8"
                Padding="24"
                Margin="0,0,0,24">
            <!-- Section content -->
        </StackPanel>
    </StackPanel>
</ScrollViewer>
```

### Accessibility (WCAG AA)

**Requirements:**
1. **Color contrast** - 4.5:1 for normal text, 3:1 for large text
2. **Focus indicators** - Visible keyboard navigation
3. **Screen reader support** - AutomationProperties
4. **Keyboard navigation** - TabIndex and TabNavigation

**Implementation:**
```xaml
<Button Content="Save"
        Command="{Binding SaveCommand}"
        TabIndex="0"
        AutomationProperties.Name="Save Project"
        AutomationProperties.HelpText="Saves current project settings"
        ToolTip="Save project (Ctrl+S)"/>
```

**Complete AutomationProperties Pattern:**
```xaml
<!-- For interactive controls -->
<Button Command="{Binding StartCrawlCommand}"
        TabIndex="11"
        IsDefault="True"
        AutomationProperties.Name="Start Crawl"
        AutomationProperties.HelpText="Begins the web crawl with the configured settings"
        ToolTip="Begin crawling with current settings (F6)">
    <StackPanel Orientation="Horizontal">
        <TextBlock Text="{StaticResource Icon.Play}" Style="{StaticResource Icon}"/>
        <TextBlock Text="Start Crawl"/>
    </StackPanel>
</Button>

<!-- For form fields -->
<TextBox Text="{Binding ProjectName, UpdateSourceTrigger=PropertyChanged}"
         Style="{StaticResource ModernTextBox}"
         TabIndex="0"
         AutomationProperties.Name="Project Name"
         AutomationProperties.IsRequiredForForm="True"
         ToolTip="Enter a descriptive name for your project">
    <TextBox.Tag>e.g., My Website Audit</TextBox.Tag>
</TextBox>

<!-- For labels (use AutomationId for testing) -->
<TextBlock Text="Project Name" 
           Style="{StaticResource FormFieldLabel}"
           AutomationProperties.AutomationId="ProjectNameLabel"/>

<!-- For dynamic content -->
<TextBlock Text="{Binding ProgressPercentage, StringFormat={}{0:F1}%}"
           Style="{StaticResource DisplayTextStyle}"
           AutomationProperties.Name="Progress Percentage"
           AutomationProperties.LiveSetting="Polite"/>

<!-- For critical alerts -->
<TextBlock Text="{Binding ErrorCount}"
           AutomationProperties.LiveSetting="Assertive"
           AutomationProperties.HelpText="Number of errors encountered during the crawl"/>
```

**Focus Management:**
```xaml
<!-- Window/UserControl level -->
<Grid KeyboardNavigation.TabNavigation="Local">
    <!-- TabNavigation options:
         - None: Skip in tab order
         - Continue: Default behavior (inherits from parent)
         - Local: Contained within control (stays inside)
         - Cycle: Tab cycles within control forever -->
    
    <!-- Nested sections with their own tab order -->
    <StackPanel KeyboardNavigation.TabNavigation="Local">
        <Button TabIndex="0"/>
        <Button TabIndex="1"/>
        <Button TabIndex="2"/>
    </StackPanel>
</Grid>

<!-- Disable focus scope for nested controls -->
<TextBox TabIndex="0"
         FocusManager.IsFocusScope="False"/>
```

**Heading Levels:**
```xaml
<TextBlock Text="Main Heading"
           Style="{StaticResource DisplayTextStyle}"
           AutomationProperties.HeadingLevel="Level1"/>

<TextBlock Text="Section Heading"
           Style="{StaticResource TitleTextStyle}"
           AutomationProperties.HeadingLevel="Level2"/>

<TextBlock Text="Subsection"
           Style="{StaticResource SubtitleTextStyle}"
           AutomationProperties.HeadingLevel="Level3"/>
```

**Live Regions:**
```xaml
<!-- Polite: Announces when screen reader is idle -->
<TextBlock Text="{Binding StatusMessage}"
           AutomationProperties.LiveSetting="Polite"/>

<!-- Assertive: Interrupts to announce immediately (use sparingly for critical info) -->
<TextBlock Text="{Binding ErrorCount}"
           AutomationProperties.LiveSetting="Assertive"/>

<!-- Off: Never announces changes (default) -->
<TextBlock Text="{Binding FindingsPageHeading}"
           AutomationProperties.LiveSetting="Off"/>
```

**Accessible Menus and Context Menus:**
```xaml
<Menu AutomationProperties.Name="Main Menu"
      AutomationProperties.HelpText="Main application menu with File, View, Crawl, Tools, and Help options"
      AutomationProperties.IsRequiredForForm="False">
    <MenuItem Header="_File">
        <MenuItem Header="_New Project" 
                  Command="{Binding NewProjectCommand}" 
                  InputGestureText="Ctrl+N">
            <MenuItem.Icon>
                <TextBlock Text="{StaticResource Icon.FolderAdd}" Style="{StaticResource Icon}"/>
            </MenuItem.Icon>
        </MenuItem>
    </MenuItem>
</Menu>

<ContextMenu AutomationProperties.Name="Findings Context Menu">
    <MenuItem Header="Copy URL" 
              Command="{Binding CopyUrlCommand}"
              InputGestureText="Ctrl+C"
              AutomationProperties.Name="Copy URL to Clipboard"
              AutomationProperties.HelpText="Copy the selected finding's URL to clipboard (Ctrl+C)">
        <MenuItem.Icon>
            <TextBlock Text="{StaticResource Icon.Copy}" Style="{StaticResource Icon}"/>
        </MenuItem.Icon>
    </MenuItem>
</ContextMenu>
```

### Loading States

**Dual Loading Approach** - Use both overlay and skeleton for best UX:

**1. Loading Overlay** (for page initialization):
```xaml
<!-- Full-screen loading overlay -->
<Grid Style="{StaticResource LoadingOverlay}"
      Visibility="{Binding DataContext.IsInitializing, RelativeSource={RelativeSource AncestorType=Window}, Converter={StaticResource BooleanToVisibilityConverter}}"
      KeyboardNavigation.TabNavigation="None"
      Focusable="False">
    <Border Padding="{StaticResource SpacingXl}" 
            MaxWidth="450"
            HorizontalAlignment="Center"
            VerticalAlignment="Center"
            Background="{StaticResource SurfaceBrush}"
            CornerRadius="12"
            SnapsToDevicePixels="True">
        <Border.Effect>
            <DropShadowEffect Color="#000000" 
                              BlurRadius="32" 
                              ShadowDepth="8" 
                              Opacity="0.15"/>
        </Border.Effect>
        
        <StackPanel>
            <!-- Animated Icon -->
            <TextBlock Text="{StaticResource Icon.Cog}"
                       Style="{StaticResource Icon}"
                       Width="48" Height="48"
                       FontSize="48"
                       Foreground="{StaticResource PrimaryBrush}"
                       Margin="0,0,0,24"
                       RenderTransformOrigin="0.5,0.5">
                <TextBlock.RenderTransform>
                    <RotateTransform />
                </TextBlock.RenderTransform>
                <TextBlock.Triggers>
                    <EventTrigger RoutedEvent="Loaded">
                        <BeginStoryboard>
                            <Storyboard RepeatBehavior="Forever">
                                <DoubleAnimation Storyboard.TargetProperty="(UIElement.RenderTransform).(RotateTransform.Angle)"
                                                 From="0" To="360" Duration="0:0:2"
                                                 RepeatBehavior="Forever"/>
                            </Storyboard>
                        </BeginStoryboard>
                    </EventTrigger>
                </TextBlock.Triggers>
            </TextBlock>
            
            <TextBlock Text="Initializing Application" 
                       Style="{StaticResource TitleTextStyle}"
                       HorizontalAlignment="Center"
                       Margin="{StaticResource SpacingS}"
                       AutomationProperties.LiveSetting="Polite"
                       AutomationProperties.HeadingLevel="Level1"/>
            
            <TextBlock Text="Setting up crawler and plugins..." 
                       Style="{StaticResource BodyTextStyle}"
                       Foreground="{StaticResource TextSecondaryBrush}"
                       HorizontalAlignment="Center"
                       Margin="{StaticResource SpacingL}"/>
        </StackPanel>
    </Border>
</Grid>
```

**2. Skeleton Screens** (for content loading):
```xaml
<Grid>
    <!-- Skeleton Loader (shown while loading) -->
    <ItemsControl Visibility="{Binding IsLoading, Converter={StaticResource BooleanToVisibilityConverter}}"
                  Margin="12">
        <ItemsControl.Items>
            <!-- Multiple skeleton rows -->
            <Border Style="{StaticResource SkeletonRow}">
                <Grid Margin="12,0">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="110"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="350"/>
                        <ColumnDefinition Width="160"/>
                    </Grid.ColumnDefinitions>
                    <Rectangle Grid.Column="0" Style="{StaticResource SkeletonCell}" Width="80"/>
                    <Rectangle Grid.Column="1" Style="{StaticResource SkeletonCell}" Width="200"/>
                    <Rectangle Grid.Column="2" Style="{StaticResource SkeletonCell}" Width="280"/>
                    <Rectangle Grid.Column="3" Style="{StaticResource SkeletonCell}" Width="130"/>
                </Grid>
            </Border>
            <Border Style="{StaticResource SkeletonRow}">
                <Grid Margin="12,0">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="110"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="350"/>
                        <ColumnDefinition Width="160"/>
                    </Grid.ColumnDefinitions>
                    <Rectangle Grid.Column="0" Style="{StaticResource SkeletonCell}" Width="80"/>
                    <Rectangle Grid.Column="1" Style="{StaticResource SkeletonCell}" Width="250"/>
                    <Rectangle Grid.Column="2" Style="{StaticResource SkeletonCell}" Width="300"/>
                    <Rectangle Grid.Column="3" Style="{StaticResource SkeletonCell}" Width="130"/>
                </Grid>
            </Border>
            <!-- Add more rows as needed -->
        </ItemsControl.Items>
    </ItemsControl>
    
    <!-- Actual content (hidden while loading) -->
    <DataGrid Visibility="{Binding IsLoading, Converter={StaticResource InverseBooleanToVisibilityConverter}}"
              ItemsSource="{Binding Items}"
              SelectedItem="{Binding SelectedItem, Mode=TwoWay}"
              Style="{StaticResource ModernDataGrid}"/>
</Grid>
```

**3. Indeterminate Progress Bar** (for unknown duration):
```xaml
<!-- Thin progress bar for subtle loading -->
<ProgressBar IsIndeterminate="True"
             Style="{StaticResource ModernProgressBar}"
             Height="4"
             Margin="0,12,0,0"
             Visibility="{Binding IsTestingProxy, Converter={StaticResource BooleanToVisibilityConverter}}"/>

<!-- Full-width with label -->
<StackPanel>
    <TextBlock Text="Loading..."
               Style="{StaticResource TitleTextStyle}"/>
    <ProgressBar IsIndeterminate="True"
                 Style="{StaticResource ModernProgressBar}"/>
</StackPanel>
```

**4. Skeleton for Cards** (metric/dashboard loading):
```xaml
<Border Visibility="{Binding IsLoading, Converter={StaticResource BooleanToVisibilityConverter}}"
        Background="{StaticResource SurfaceBrush}"
        CornerRadius="8"
        Padding="20"
        SnapsToDevicePixels="True">
    <Border.Effect>
        <DropShadowEffect Color="#000000" BlurRadius="4" ShadowDepth="1" Opacity="0.06"/>
    </Border.Effect>
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>
        <Rectangle Grid.Row="0" Style="{StaticResource SkeletonCell}" Width="140" Height="20" Margin="0,0,0,12"/>
        <Rectangle Grid.Row="1" Style="{StaticResource SkeletonCell}" Width="80" Height="36"/>
    </Grid>
</Border>
```

### Empty States

**Pattern:**
```xaml
<StackPanel Style="{StaticResource EmptyStateContainer}"
            Visibility="{Binding Items.Count, Converter={StaticResource InverseInt32ToVisibilityConverter}}">
    <TextBlock Text="{StaticResource Icon.Search}"
               Style="{StaticResource EmptyStateIcon}"/>
    <TextBlock Text="No Items Found"
               Style="{StaticResource EmptyStateTitle}"/>
    <TextBlock Text="Try adjusting your filters or create a new item."
               Style="{StaticResource EmptyStateMessage}"/>
    <Button Content="Create New"
            Command="{Binding CreateCommand}"
            Style="{StaticResource PrimaryButton}"
            Margin="{StaticResource SpacingM}"/>
</StackPanel>
```

### Error Handling

**Inline Errors:**
```xaml
<TextBox Text="{Binding EmailAddress, UpdateSourceTrigger=PropertyChanged}"
         Style="{StaticResource ModernTextBox}"/>
<TextBlock Text="Please enter a valid email address"
           Style="{StaticResource ValidationErrorText}"
           Visibility="{Binding HasEmailError, Converter={StaticResource BooleanToVisibilityConverter}}"/>
```

**Error Cards:**
```xaml
<Border Style="{StaticResource ErrorMessageCard}"
        Visibility="{Binding HasError, Converter={StaticResource BooleanToVisibilityConverter}}">
    <StackPanel Orientation="Horizontal">
        <TextBlock Text="{StaticResource Icon.Error}"
                   Style="{StaticResource Icon}"
                   Foreground="{StaticResource ErrorBrush}"
                   Margin="0,0,12,0"/>
        <StackPanel>
            <TextBlock Text="Error"
                       Style="{StaticResource BodyEmphasisTextStyle}"
                       Foreground="{StaticResource ErrorBrush}"/>
            <TextBlock Text="{Binding ErrorMessage}"
                       Style="{StaticResource BodyTextStyle}"/>
        </StackPanel>
    </StackPanel>
</Border>
```

**Toast Notifications:**
```csharp
// In ViewModel - inject IToastService
_toastService.ShowSuccess("Settings saved", "Your changes have been saved successfully");
_toastService.ShowError("Save failed", "Unable to save settings. Please try again.");
_toastService.ShowWarning("Warning", "This action cannot be undone");
_toastService.ShowInfo("Info", "Processing your request...");
```

### Animation Patterns

**Standard Page Load Animation** (apply to main Grid of every view):
```xaml
<Grid Margin="{StaticResource SpacingL}" KeyboardNavigation.TabNavigation="Local">
    <Grid.RenderTransform>
        <TranslateTransform/>
    </Grid.RenderTransform>
    <Grid.Triggers>
        <EventTrigger RoutedEvent="Loaded">
            <BeginStoryboard>
                <Storyboard>
                    <DoubleAnimation Storyboard.TargetProperty="(UIElement.RenderTransform).(TranslateTransform.Y)"
                                     From="20" To="0" Duration="0:0:0.4"
                                     DecelerationRatio="0.7"/>
                    <DoubleAnimation Storyboard.TargetProperty="Opacity"
                                     From="0" To="1" Duration="0:0:0.4"
                                     DecelerationRatio="0.7"/>
                </Storyboard>
            </BeginStoryboard>
        </EventTrigger>
    </Grid.Triggers>
    
    <!-- Your content here -->
</Grid>
```

**Rotating Icon Animation** (for loading states):
```xaml
<TextBlock Text="{StaticResource Icon.Cog}"
           Style="{StaticResource Icon}"
           FontSize="48"
           Foreground="{StaticResource PrimaryBrush}"
           RenderTransformOrigin="0.5,0.5">
    <TextBlock.RenderTransform>
        <RotateTransform />
    </TextBlock.RenderTransform>
    <TextBlock.Triggers>
        <EventTrigger RoutedEvent="Loaded">
            <BeginStoryboard>
                <Storyboard RepeatBehavior="Forever">
                    <DoubleAnimation Storyboard.TargetProperty="(UIElement.RenderTransform).(RotateTransform.Angle)"
                                     From="0" To="360" Duration="0:0:2"
                                     RepeatBehavior="Forever"/>
                </Storyboard>
            </BeginStoryboard>
        </EventTrigger>
    </TextBlock.Triggers>
</TextBlock>
```

**Pulsing Opacity Animation** (for empty state icons):
```xaml
<TextBlock Text="{StaticResource Icon.Search}"
           Style="{StaticResource EmptyStateIcon}">
    <TextBlock.Triggers>
        <EventTrigger RoutedEvent="Loaded">
            <BeginStoryboard>
                <Storyboard RepeatBehavior="Forever">
                    <DoubleAnimation Storyboard.TargetProperty="Opacity"
                                     From="0.5" To="1.0" Duration="0:0:2"
                                     AutoReverse="True">
                        <DoubleAnimation.EasingFunction>
                            <CubicEase EasingMode="EaseInOut"/>
                        </DoubleAnimation.EasingFunction>
                    </DoubleAnimation>
                </Storyboard>
            </BeginStoryboard>
        </EventTrigger>
    </TextBlock.Triggers>
</TextBlock>
```

**Button Hover & Press** - Built into button styles:
- Scale: 1.01 on hover, 0.98 on press
- Background color change
- Smooth transitions with RenderTransform

**Toast Slide-In Animation:**
```xaml
<UserControl.RenderTransform>
    <TranslateTransform x:Name="SlideTransform"/>
</UserControl.RenderTransform>

<UserControl.Triggers>
    <EventTrigger RoutedEvent="Loaded">
        <BeginStoryboard>
            <Storyboard>
                <DoubleAnimation Storyboard.TargetName="SlideTransform"
                                 Storyboard.TargetProperty="X"
                                 From="400" To="0" Duration="0:0:0.3">
                    <DoubleAnimation.EasingFunction>
                        <CubicEase EasingMode="EaseOut"/>
                    </DoubleAnimation.EasingFunction>
                </DoubleAnimation>
            </Storyboard>
        </BeginStoryboard>
    </EventTrigger>
</UserControl.Triggers>
```

### Keyboard Navigation

**Standard Shortcuts (defined in MainWindow.xaml):**
- `Ctrl+N` - New Project
- `Ctrl+O` - Open Project
- `Ctrl+W` - Close Project
- `Ctrl+S` - Save Project
- `Ctrl+1/2/3` - Navigate between views
- `F5` - Refresh
- `F6` - Start Crawl
- `F8` - Stop Crawl
- `Ctrl+E` - Export to Excel
- `Ctrl+Shift+E` - Export to CSV
- `Ctrl+Q` - Exit

**Context Menu Shortcuts:**
```xaml
<MenuItem Header="Copy URL"
          Command="{Binding CopyUrlCommand}"
          InputGestureText="Ctrl+C"/>
```

---

## Common Patterns

### Creating New Views

**Step 1: Create the View (XAML)**

`Views/MyNewView.xaml`:
```xaml
<UserControl x:Class="ShoutingIguana.Views.MyNewView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             Background="{StaticResource BackgroundBrush}">
    
    <Grid Margin="{StaticResource SpacingL}">
        <!-- Your UI here -->
    </Grid>
</UserControl>
```

`Views/MyNewView.xaml.cs`:
```csharp
using System.Windows.Controls;

namespace ShoutingIguana.Views;

public partial class MyNewView : UserControl
{
    public MyNewView(MyNewViewModel viewModel)
    {
        InitializeComponent();
        DataContext = viewModel;
        
        // Initialize view
        _ = viewModel.LoadAsync();
    }
}
```

**Step 2: Create the ViewModel**

`ViewModels/MyNewViewModel.cs`:
```csharp
using CommunityToolkit.Mvvm.ComponentModel;
using CommunityToolkit.Mvvm.Input;
using Microsoft.Extensions.Logging;

namespace ShoutingIguana.ViewModels;

public partial class MyNewViewModel : ObservableObject, IDisposable
{
    private readonly ILogger<MyNewViewModel> _logger;
    private bool _disposed;
    
    [ObservableProperty]
    private string _title = "My New View";
    
    [ObservableProperty]
    private bool _isLoading;
    
    public MyNewViewModel(ILogger<MyNewViewModel> logger)
    {
        _logger = logger;
    }
    
    public async Task LoadAsync()
    {
        IsLoading = true;
        try
        {
            // Load data
            await Task.Delay(100); // Simulate load
        }
        catch (Exception ex)
        {
            _logger.LogError(ex, "Failed to load data");
        }
        finally
        {
            IsLoading = false;
        }
    }
    
    [RelayCommand]
    private async Task DoSomethingAsync()
    {
        // Implementation
    }
    
    public void Dispose()
    {
        if (_disposed) return;
        
        // Cleanup
        _disposed = true;
    }
}
```

**Step 3: Register Services**

In `App.xaml.cs`:
```csharp
services.AddTransient<MyNewViewModel>();
services.AddTransient<MyNewView>();
```

**Step 4: Navigate to View**

```csharp
_navigationService.NavigateTo<MyNewView>();
```

### Using Converters

**Built-in Converters** (defined in `App.xaml`):
```xaml
<!-- Boolean to Visibility -->
Visibility="{Binding IsVisible, Converter={StaticResource BooleanToVisibilityConverter}}"

<!-- Inverse Boolean to Visibility -->
Visibility="{Binding IsHidden, Converter={StaticResource InverseBooleanToVisibilityConverter}}"

<!-- Null to Visibility -->
Visibility="{Binding MyObject, Converter={StaticResource NullToVisibilityConverter}}"

<!-- Int32 to Visibility (visible if > 0) -->
Visibility="{Binding Count, Converter={StaticResource Int32ToVisibilityConverter}}"

<!-- Inverse Int32 to Visibility (visible if = 0) -->
Visibility="{Binding Count, Converter={StaticResource InverseInt32ToVisibilityConverter}}"

<!-- Inverse Boolean -->
IsEnabled="{Binding IsDisabled, Converter={StaticResource InverseBooleanConverter}}"
```

**Creating Custom Converters:**

`Converters/MyCustomConverter.cs`:
```csharp
using System;
using System.Globalization;
using System.Windows.Data;

namespace ShoutingIguana.Converters;

public class MyCustomConverter : IValueConverter
{
    public object Convert(object value, Type targetType, object parameter, CultureInfo culture)
    {
        // Convert from source to target
        if (value is MyType myValue)
        {
            return myValue.ToString();
        }
        return string.Empty;
    }
    
    public object ConvertBack(object value, Type targetType, object parameter, CultureInfo culture)
    {
        // Convert from target to source (for two-way binding)
        throw new NotImplementedException();
    }
}
```

Register in `App.xaml`:
```xaml
<converters:MyCustomConverter x:Key="MyCustomConverter"/>
```

### Working with Services

**Creating a Service:**

Interface in `Services/IMyService.cs`:
```csharp
namespace ShoutingIguana.Services;

public interface IMyService
{
    Task<string> DoSomethingAsync();
}
```

Implementation in `Services/MyService.cs`:
```csharp
using Microsoft.Extensions.Logging;

namespace ShoutingIguana.Services;

public class MyService : IMyService
{
    private readonly ILogger<MyService> _logger;
    
    public MyService(ILogger<MyService> logger)
    {
        _logger = logger;
    }
    
    public async Task<string> DoSomethingAsync()
    {
        _logger.LogInformation("Doing something...");
        await Task.Delay(100);
        return "Done!";
    }
}
```

**Register in App.xaml.cs:**
```csharp
services.AddSingleton<IMyService, MyService>();
```

**Use in ViewModel:**
```csharp
public partial class MyViewModel : ObservableObject
{
    private readonly IMyService _myService;
    
    public MyViewModel(IMyService myService)
    {
        _myService = myService;
    }
    
    [RelayCommand]
    private async Task ExecuteAsync()
    {
        var result = await _myService.DoSomethingAsync();
    }
}
```

### Database Operations

**Pattern for Repository Access:**
```csharp
// In ViewModel or Service
private readonly IServiceProvider _serviceProvider;

public async Task DoWorkAsync()
{
    // Create a scope for database operations
    using var scope = _serviceProvider.CreateScope();
    
    // Get repositories from the scope
    var projectRepo = scope.ServiceProvider.GetRequiredService<IProjectRepository>();
    var urlRepo = scope.ServiceProvider.GetRequiredService<IUrlRepository>();
    
    // Perform operations
    var project = await projectRepo.GetByIdAsync(projectId);
    var urls = await urlRepo.GetUrlsByProjectAsync(projectId);
    
    // Scope and context are disposed automatically
}
```

**Why Use Scopes?**
- Database contexts are not thread-safe
- Scoped lifetime ensures proper disposal
- Each operation gets a fresh context

### Form Layouts

**Standard Form Pattern:**
```xaml
<Border Style="{StaticResource Card}">
    <StackPanel>
        <!-- Section Header -->
        <TextBlock Text="Basic Information"
                   Style="{StaticResource FormSectionHeader}"/>
        
        <!-- Form Field -->
        <StackPanel Style="{StaticResource InputContainer}">
            <!-- Label with required indicator -->
            <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                <TextBlock Text="Project Name"
                           Style="{StaticResource FormFieldLabel}"/>
                <TextBlock Style="{StaticResource RequiredIndicator}"/>
            </StackPanel>
            
            <!-- Input -->
            <TextBox Text="{Binding ProjectName, UpdateSourceTrigger=PropertyChanged}"
                     Style="{StaticResource ModernTextBox}"
                     TabIndex="0">
                <TextBox.Tag>e.g., My Project</TextBox.Tag>
            </TextBox>
            
            <!-- Helper Text -->
            <TextBlock Text="Enter a descriptive name for your project"
                       Style="{StaticResource HelperText}"/>
        </StackPanel>
        
        <!-- More fields... -->
        
        <!-- Action Buttons -->
        <StackPanel Orientation="Horizontal"
                    HorizontalAlignment="Right"
                    Margin="0,24,0,0">
            <Button Content="Cancel"
                    Command="{Binding CancelCommand}"
                    Style="{StaticResource SecondaryButton}"
                    Margin="0,0,12,0"/>
            <Button Content="Save"
                    Command="{Binding SaveCommand}"
                    Style="{StaticResource PrimaryButton}"/>
        </StackPanel>
    </StackPanel>
</Border>
```

### Context Menus

**DataGrid Context Menu:**
```xaml
<DataGrid ItemsSource="{Binding Items}">
    <DataGrid.ContextMenu>
        <ContextMenu>
            <MenuItem Header="Copy"
                      Command="{Binding CopyCommand}"
                      InputGestureText="Ctrl+C">
                <MenuItem.Icon>
                    <TextBlock Text="{StaticResource Icon.Copy}"
                               Style="{StaticResource Icon}"/>
                </MenuItem.Icon>
            </MenuItem>
            <Separator/>
            <MenuItem Header="Delete"
                      Command="{Binding DeleteCommand}">
                <MenuItem.Icon>
                    <TextBlock Text="{StaticResource Icon.Delete}"
                               Style="{StaticResource Icon}"/>
                </MenuItem.Icon>
            </MenuItem>
        </ContextMenu>
    </DataGrid.ContextMenu>
</DataGrid>
```

**Accessing Selected Item:**
```csharp
[ObservableProperty]
private MyItem? _selectedItem;

[RelayCommand(CanExecute = nameof(CanCopy))]
private void Copy()
{
    if (SelectedItem != null)
    {
        Clipboard.SetText(SelectedItem.Value);
    }
}

private bool CanCopy() => SelectedItem != null;
```

---

## Code Examples

### Complete View Example

**ProjectHomeView.xaml** (simplified):
```xaml
<UserControl x:Class="ShoutingIguana.Views.ProjectHomeView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             Background="{StaticResource BackgroundBrush}">
    
    <ScrollViewer VerticalScrollBarVisibility="Auto"
                  Padding="{StaticResource SpacingL}">
        <Border Padding="48"
                MaxWidth="950"
                HorizontalAlignment="Center"
                Style="{StaticResource Card}">
            <StackPanel>
                <!-- Header -->
                <Grid Margin="0,0,0,32">
                    <StackPanel Orientation="Horizontal">
                        <Border Background="{StaticResource PrimaryBrush}"
                                Width="44" Height="44"
                                CornerRadius="8"
                                Margin="0,0,16,0">
                            <TextBlock Text="{StaticResource Icon.Settings}"
                                       Style="{StaticResource Icon}"
                                       FontSize="22"
                                       Foreground="White"/>
                        </Border>
                        <StackPanel VerticalAlignment="Center">
                            <TextBlock Text="Project Settings"
                                       Style="{StaticResource TitleTextStyle}"/>
                            <TextBlock Text="Configure your web crawling project"
                                       Style="{StaticResource BodyTextStyle}"
                                       Foreground="{StaticResource TextSecondaryBrush}"/>
                        </StackPanel>
                    </StackPanel>
                </Grid>
                
                <!-- Form Section -->
                <Border Background="{StaticResource SurfaceAltBrush}"
                        CornerRadius="8"
                        Padding="24">
                    <StackPanel>
                        <TextBlock Text="Basic Information"
                                   Style="{StaticResource FormSectionHeader}"/>
                        
                        <StackPanel Style="{StaticResource InputContainer}">
                            <TextBlock Text="Project Name"
                                       Style="{StaticResource FormFieldLabel}"/>
                            <TextBox Text="{Binding ProjectName}"
                                     Style="{StaticResource ModernTextBox}"/>
                        </StackPanel>
                        
                        <StackPanel Style="{StaticResource InputContainer}">
                            <TextBlock Text="Base URL"
                                       Style="{StaticResource FormFieldLabel}"/>
                            <TextBox Text="{Binding BaseUrl}"
                                     Style="{StaticResource ModernTextBox}"/>
                        </StackPanel>
                    </StackPanel>
                </Border>
                
                <!-- Actions -->
                <StackPanel Orientation="Horizontal"
                            HorizontalAlignment="Right"
                            Margin="0,24,0,0">
                    <Button Content="Save Settings"
                            Command="{Binding SaveCommand}"
                            Style="{StaticResource SecondaryButton}"
                            Margin="0,0,12,0"/>
                    <Button Command="{Binding StartCrawlCommand}"
                            Style="{StaticResource PrimaryButton}">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="{StaticResource Icon.Play}"
                                       Style="{StaticResource Icon}"
                                       Margin="0,0,8,0"/>
                            <TextBlock Text="Start Crawl"/>
                        </StackPanel>
                    </Button>
                </StackPanel>
            </StackPanel>
        </Border>
    </ScrollViewer>
</UserControl>
```

### Complete ViewModel Example

**ProjectHomeViewModel.cs** (simplified):
```csharp
using System;
using System.Threading.Tasks;
using CommunityToolkit.Mvvm.ComponentModel;
using CommunityToolkit.Mvvm.Input;
using Microsoft.Extensions.Logging;
using ShoutingIguana.Services;

namespace ShoutingIguana.ViewModels;

public partial class ProjectHomeViewModel : ObservableObject
{
    private readonly ILogger<ProjectHomeViewModel> _logger;
    private readonly INavigationService _navigationService;
    private readonly IToastService _toastService;
    
    [ObservableProperty]
    [NotifyCanExecuteChangedFor(nameof(StartCrawlCommand))]
    private string _projectName = string.Empty;
    
    [ObservableProperty]
    [NotifyCanExecuteChangedFor(nameof(StartCrawlCommand))]
    private string _baseUrl = string.Empty;
    
    [ObservableProperty]
    private bool _isLoading;
    
    public ProjectHomeViewModel(
        ILogger<ProjectHomeViewModel> logger,
        INavigationService navigationService,
        IToastService toastService)
    {
        _logger = logger;
        _navigationService = navigationService;
        _toastService = toastService;
    }
    
    public async Task LoadAsync()
    {
        IsLoading = true;
        try
        {
            // Load data
            await Task.Delay(100);
        }
        catch (Exception ex)
        {
            _logger.LogError(ex, "Failed to load data");
            _toastService.ShowError("Load Failed", ex.Message);
        }
        finally
        {
            IsLoading = false;
        }
    }
    
    [RelayCommand]
    private async Task SaveAsync()
    {
        try
        {
            // Validate
            if (string.IsNullOrWhiteSpace(ProjectName))
            {
                _toastService.ShowWarning("Validation Error", "Project name is required");
                return;
            }
            
            // Save logic here
            await Task.Delay(100);
            
            _toastService.ShowSuccess("Saved", "Settings saved successfully");
            _logger.LogInformation("Project settings saved");
        }
        catch (Exception ex)
        {
            _logger.LogError(ex, "Failed to save settings");
            _toastService.ShowError("Save Failed", ex.Message);
        }
    }
    
    [RelayCommand(CanExecute = nameof(CanStartCrawl))]
    private async Task StartCrawlAsync()
    {
        await SaveAsync();
        _navigationService.NavigateTo<CrawlDashboardView>();
    }
    
    private bool CanStartCrawl()
    {
        return !string.IsNullOrWhiteSpace(ProjectName) &&
               !string.IsNullOrWhiteSpace(BaseUrl) &&
               Uri.TryCreate(BaseUrl, UriKind.Absolute, out _);
    }
}
```

### Custom Control Example

**ToastNotification.xaml** (simplified):
```xaml
<UserControl x:Class="ShoutingIguana.Controls.ToastNotification"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml">
    
    <UserControl.RenderTransform>
        <TranslateTransform x:Name="SlideTransform"/>
    </UserControl.RenderTransform>
    
    <UserControl.Triggers>
        <EventTrigger RoutedEvent="Loaded">
            <BeginStoryboard>
                <Storyboard>
                    <DoubleAnimation Storyboard.TargetName="SlideTransform"
                                     Storyboard.TargetProperty="X"
                                     From="400" To="0" Duration="0:0:0.3">
                        <DoubleAnimation.EasingFunction>
                            <CubicEase EasingMode="EaseOut"/>
                        </DoubleAnimation.EasingFunction>
                    </DoubleAnimation>
                </Storyboard>
            </BeginStoryboard>
        </EventTrigger>
    </UserControl.Triggers>
    
    <Border CornerRadius="8"
            Padding="16,12"
            MinWidth="300"
            MaxWidth="400"
            Background="{StaticResource SuccessBackground}"
            BorderBrush="{StaticResource SuccessBrush}"
            BorderThickness="0,0,0,3">
        <Border.Effect>
            <DropShadowEffect Color="#000000" BlurRadius="12" ShadowDepth="4" Opacity="0.15"/>
        </Border.Effect>
        
        <Grid>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>
            
            <!-- Icon -->
            <Border Grid.Column="0"
                    Width="32" Height="32"
                    CornerRadius="16"
                    Background="{StaticResource SuccessBrush}"
                    Margin="0,0,12,0">
                <TextBlock Text="{StaticResource Icon.Success}"
                           Style="{StaticResource Icon}"
                           Foreground="White"/>
            </Border>
            
            <!-- Message -->
            <StackPanel Grid.Column="1" VerticalAlignment="Center">
                <TextBlock Text="{Binding Title}"
                           Style="{StaticResource BodyEmphasisTextStyle}"/>
                <TextBlock Text="{Binding Message}"
                           Style="{StaticResource CaptionTextStyle}"/>
            </StackPanel>
            
            <!-- Close Button -->
            <Button Grid.Column="2"
                    Command="{Binding CloseCommand}"
                    Width="28" Height="28"
                    Background="Transparent"
                    BorderThickness="0"
                    Cursor="Hand">
                <TextBlock Text="{StaticResource Icon.Close}"
                           Style="{StaticResource Icon}"
                           FontSize="12"/>
            </Button>
        </Grid>
    </Border>
</UserControl>
```

---

## Best Practices

### Rendering & Performance

**Always Set These Properties:**
```xaml
<!-- Window level -->
<Window UseLayoutRounding="True"
        TextOptions.TextFormattingMode="Display">
    
    <!-- All Borders (cards, containers) -->
    <Border SnapsToDevicePixels="True"
            CornerRadius="8">
        <!-- Content -->
    </Border>
</Window>
```

**Why:**
- `UseLayoutRounding="True"` - Prevents blurry edges by rounding to pixel boundaries
- `TextOptions.TextFormattingMode="Display"` - Improves text clarity
- `SnapsToDevicePixels="True"` - Ensures crisp rendering on all DPI settings

**MaxWidth for Readability:**
- Forms and settings: 750-850px
- Dialogs: 900-1000px
- Wide content areas: 1200px
- Use on ScrollViewer content for optimal line length

### Button Style Usage

**Primary Button:**
- Main call-to-action on a page
- Use sparingly (1-2 per view)
- Set `IsDefault="True"` for Enter key activation
- Examples: "Start Crawl", "Save Settings", "Create Project"

**Secondary Button:**
- Alternative actions
- Supporting actions
- Cancel buttons (with `IsCancel="True"`)
- Examples: "Cancel", "Refresh", "Export to CSV"

**Danger Button:**
- Destructive actions that cannot be undone
- Always confirm with MessageBox first
- Use red color to indicate caution
- Examples: "Delete Project", "Clear Queue", "Stop Crawl"

**Large Button:**
- Prominent actions on landing pages
- Welcome screens and empty states
- Height: 48px, increased padding
- Examples: "Get Started", "New Project"

**Button with Icons:**
```xaml
<Button Command="{Binding StartCrawlCommand}"
        Style="{StaticResource PrimaryButton}"
        Height="52"
        Padding="28,12">
    <StackPanel Orientation="Horizontal">
        <TextBlock Text="{StaticResource Icon.Play}"
                   Style="{StaticResource Icon}"
                   Width="20" Height="20"
                   FontSize="20"
                   Margin="0,0,8,0"/>
        <TextBlock Text="Start Crawl" 
                   VerticalAlignment="Center"
                   FontSize="15"/>
    </StackPanel>
</Button>
```

### Spacing Guidelines

**Between Elements:**
- Use `SpacingXs` (4px) - Between related small elements
- Use `SpacingS` (8px) - Between form field label and input
- Use `SpacingM` (16px) - Between form fields
- Use `SpacingL` (24px) - Between sections, page padding
- Use `SpacingXl` (32px) - Between major sections
- Use `SpacingXxl` (48px) - Large gaps, hero sections

**Card Padding:**
- Standard cards: `SpacingL` (24px)
- Metric cards: `SpacingM` (16px)
- Page containers: `SpacingL` to `SpacingXxl`

### Color Usage

**Text:**
- `TextPrimaryBrush` - Main content, headings
- `TextSecondaryBrush` - Descriptions, subtitles
- `TextTertiaryBrush` - Metadata, de-emphasized text

**Backgrounds:**
- `BackgroundBrush` - Page background
- `SurfaceBrush` - Cards, panels
- `SurfaceAltBrush` - Alternating rows, nested sections

**Semantic:**
- `SuccessBrush` - Success states, confirmations
- `ErrorBrush` - Errors, validation failures, dangerous actions
- `WarningBrush` - Warnings, cautions
- `InfoBrush` - Information, neutral notifications

**Interactive:**
- `PrimaryBrush` - Focused elements, selected states, links
- `HoverBrush` - Hover backgrounds
- `BorderBrush` - Standard borders

### Typography Usage

**Page Structure:**
```
Display (28px)      - Page title
 Body (14px)      - Page description

Title (20px)        - Section header
 Subtitle (16px)  - Subsection header
   Body (14px)   - Content
   Caption (12px) - Metadata
```

**Emphasis:**
- Use `BodyEmphasisTextStyle` for important body text
- Use `FontWeight="SemiBold"` for labels
- Avoid using all caps (hurts readability)

### Error Handling

**User-Facing Errors:**
1. **Validation errors** - Show inline below inputs
2. **Operation failures** - Show toast notification
3. **Critical errors** - Show MessageBox
4. **Background errors** - Log only, don't interrupt

**Pattern:**
```csharp
try
{
    await PerformOperationAsync();
    _toastService.ShowSuccess("Success", "Operation completed");
}
catch (ValidationException ex)
{
    // Show inline
    ErrorMessage = ex.Message;
}
catch (Exception ex)
{
    _logger.LogError(ex, "Operation failed");
    _toastService.ShowError("Operation Failed", ex.Message);
}
```

**MessageBox for Confirmations:**
```csharp
var result = MessageBox.Show(
    "Are you sure you want to delete this project?",
    "Confirm Delete",
    MessageBoxButton.YesNo,
    MessageBoxImage.Warning);

if (result == MessageBoxResult.Yes)
{
    // Proceed with deletion
}
```

### Performance Considerations

**Data Binding:**
- Use `UpdateSourceTrigger=PropertyChanged` for real-time validation
- Use `OneWay` binding for read-only data
- Use `OneTime` binding for static data

**Virtualization:**
- DataGrid automatically virtualizes
- For large ItemsControl, enable virtualization:
```xaml
<ItemsControl VirtualizingPanel.IsVirtualizing="True"
              VirtualizingPanel.VirtualizationMode="Recycling">
```

**Async Operations:**
- Always use async/await for I/O operations
- Show loading indicators for operations > 200ms
- Never block the UI thread

**Resource Management:**
- Dispose ViewModels that subscribe to events
- Use `using` statements for scopes
- Unsubscribe from events in Dispose()

### Code Organization

**File Structure:**
```
ViewModels/
 MainViewModel.cs
 ProjectHomeViewModel.cs
 FindingsViewModel.cs

Views/
 ProjectHomeView.xaml
 ProjectHomeView.xaml.cs
 FindingsView.xaml

Services/
 INavigationService.cs
 NavigationService.cs
 IToastService.cs
 ToastService.cs
```

**Naming Conventions:**
- ViewModels: `{Feature}ViewModel`
- Views: `{Feature}View`
- Services: `I{Name}Service` (interface), `{Name}Service` (implementation)
- Commands: `{Action}Command` (e.g., `SaveCommand`, `DeleteCommand`)
- Properties: PascalCase (generated from `_camelCase` fields)

---

## Quick Reference

### Style Resources Quick Lookup

**Buttons:**
- `PrimaryButton` - Main actions
- `SecondaryButton` - Alternative actions
- `DangerButton` - Destructive actions
- `LargeButton` - Prominent actions

**Cards:**
- `Card` / `StandardCard` - Content containers
- `MetricCard` - Dashboard metrics
- `InfoCard` - Notices/hints
- `ErrorMessageCard` - Error display
- `WarningMessageCard` - Warning display
- `SuccessMessageCard` - Success display

**Text Styles:**
- `DisplayTextStyle` - 28px, SemiBold
- `TitleTextStyle` - 20px, SemiBold
- `SubtitleTextStyle` - 16px, Medium
- `BodyTextStyle` - 14px, Normal
- `BodyEmphasisTextStyle` - 14px, Medium
- `CaptionTextStyle` - 12px, Normal
- `CaptionLightTextStyle` - 12px, Light

**Form Elements:**
- `ModernTextBox` - Text input
- `ModernComboBox` - Dropdown
- `StandardCheckBox` - Checkbox
- `FormFieldLabel` - Field labels
- `HelperText` - Helper text below inputs
- `ValidationErrorText` - Error messages
- `RequiredIndicator` - Red asterisk

**Data Display:**
- `ModernDataGrid` - Data tables
- `ModernProgressBar` - Progress indicators
- `StandardTabControl` - Tabbed interface

**Layout:**
- `PageContainer` - Page wrapper
- `EmptyStateContainer` - Empty state wrapper
- `ToolbarPanel` - Toolbar layout
- `InputContainer` - Form field wrapper

**Special:**
- `Icon` - Icon text style
- `ModernFocusVisual` - Focus indicator
- `LoadingOverlay` - Loading overlay
- `SkeletonRow` / `SkeletonCell` - Loading skeleton

### Common Icon Keys

```
Icon.Play, Icon.Stop, Icon.Pause, Icon.Refresh
Icon.Home, Icon.Settings, Icon.Search
Icon.Save, Icon.Close, Icon.Delete, Icon.Edit
Icon.Export, Icon.Import, Icon.Copy
Icon.Folder, Icon.FolderOpen, Icon.FolderAdd
Icon.Success, Icon.Error, Icon.Warning, Icon.Info
Icon.Web, Icon.Globe, Icon.Link
Icon.Document, Icon.Code, Icon.CodeJson
Icon.FileExcel, Icon.FileCsv
Icon.Cog, Icon.Puzzle, Icon.ChartBar
```

### Color Resource Keys

**Brand:**
`PrimaryBrush`, `PrimaryLightBrush`, `PrimaryDarkBrush`

**Backgrounds:**
`BackgroundBrush`, `SurfaceBrush`, `SurfaceVariantBrush`, `SurfaceAltBrush`

**Text:**
`TextPrimaryBrush`, `TextSecondaryBrush`, `TextTertiaryBrush`

**Semantic:**
`SuccessBrush`, `WarningBrush`, `ErrorBrush`, `InfoBrush`

**Borders:**
`BorderBrush`, `BorderLightBrush`, `DividerBrush`

**Interactive:**
`HoverBrush`, `FocusBrush`

### Spacing Values

`SpacingXs` = 4px
`SpacingS` = 8px
`SpacingM` = 16px (default)
`SpacingL` = 24px
`SpacingXl` = 32px
`SpacingXxl` = 48px

### Standard Keyboard Shortcuts

```
Ctrl+N          New Project
Ctrl+O          Open Project
Ctrl+W          Close Project
Ctrl+S          Save Project
Ctrl+1/2/3      Navigate views
F5              Refresh
F6              Start Crawl
F8              Stop Crawl
Ctrl+E          Export to Excel
Ctrl+Shift+E    Export to CSV
Ctrl+Q          Exit
Ctrl+Enter      Open in browser
Ctrl+C          Copy
```

---

## Getting Help

**Resources:**
- `Styles/Styles.xaml` - Complete style definitions with comments
- Existing views in `Views/` - Real-world examples
- ViewModels in `ViewModels/` - MVVM patterns
- Microsoft WPF docs: https://docs.microsoft.com/dotnet/desktop/wpf/

**Common Issues:**

**Binding not working:**
- Ensure property has `[ObservableProperty]` attribute
- Check DataContext is set
- Use Output window to see binding errors

**Style not applying:**
- Verify style key exists in `Styles.xaml`
- Use `BasedOn` for inherited styles
- Check for conflicting local properties

**Command not enabled:**
- Use `[NotifyCanExecuteChangedFor]` attribute
- Implement `CanExecute` method
- Call `OnPropertyChanged()` for dependencies

**Navigation not working:**
- Ensure view and ViewModel are registered in DI
- Check for exceptions in constructor
- Verify `NavigationService` is injected

---

## Summary

**Key Takeaways:**

1. **Follow MVVM** - Clear separation between Views and ViewModels
2. **Use DI** - Inject dependencies, don't create them
3. **Consistent Styling** - Always use resources from `Styles.xaml`
4. **Spacing System** - Use the 4px base unit system
5. **Accessibility** - Add AutomationProperties, support keyboard navigation
6. **Error Handling** - Log errors, show user-friendly messages
7. **Performance** - Use async/await, dispose resources properly
8. **Windows 11 Feel** - Rounded corners, subtle shadows, smooth animations

---

## Common Real-World Patterns

### Filter Bar Pattern

**Severity Filter + Search + Badge:**
```xaml
<Border Background="{StaticResource SurfaceAltBrush}"
        CornerRadius="6"
        Padding="16"
        Margin="0,0,0,16">
    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="Auto"/>
            <ColumnDefinition Width="16"/>
            <ColumnDefinition Width="*"/>
            <ColumnDefinition Width="16"/>
            <ColumnDefinition Width="Auto"/>
        </Grid.ColumnDefinitions>
        
        <!-- Severity Filter -->
        <StackPanel Grid.Column="0">
            <TextBlock Text="Severity" 
                       Style="{StaticResource FormFieldLabel}"
                       Margin="0,0,0,8"/>
            <ComboBox Width="180"
                      SelectedValue="{Binding SelectedSeverity}"
                      Style="{StaticResource ModernComboBox}">
                <ComboBoxItem Content="All Severities"/>
                <ComboBoxItem Content="Errors"/>
                <ComboBoxItem Content="Warnings"/>
                <ComboBoxItem Content="Info"/>
            </ComboBox>
        </StackPanel>
        
        <!-- Search Box -->
        <StackPanel Grid.Column="2">
            <TextBlock Text="Search" 
                       Style="{StaticResource FormFieldLabel}"
                       Margin="0,0,0,8"/>
            <TextBox Text="{Binding SearchText, UpdateSourceTrigger=PropertyChanged}"
                     Style="{StaticResource ModernTextBox}">
                <TextBox.Tag>Type to search...</TextBox.Tag>
            </TextBox>
        </StackPanel>
        
        <!-- Total Count Badge -->
        <Border Grid.Column="4"
                Background="{StaticResource PrimaryBrush}"
                CornerRadius="8"
                Padding="20,12"
                VerticalAlignment="Bottom"
                Height="40">
            <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                <TextBlock Text="Total: "
                           Foreground="White"
                           FontWeight="Medium"
                           FontSize="13"/>
                <TextBlock Text="{Binding TotalCount}" 
                           Foreground="White"
                           FontSize="18"
                           FontWeight="Bold"
                           Margin="4,0,0,0"/>
            </StackPanel>
        </Border>
    </Grid>
</Border>
```

### Grouped Settings Pattern

**Card-Based Settings Sections:**
```xaml
<ScrollViewer VerticalScrollBarVisibility="Auto" Padding="24,20">
    <StackPanel MaxWidth="750">
        
        <!-- Performance Section -->
        <Border Background="{StaticResource SurfaceBrush}"
                CornerRadius="8"
                Padding="24"
                Margin="0,0,0,24">
            <StackPanel>
                <TextBlock Text="Performance Settings" 
                           Style="{StaticResource FormSectionHeader}"
                           Margin="0,0,0,16"/>

                <StackPanel Style="{StaticResource InputContainer}">
                    <TextBlock Text="Concurrent Requests" 
                               Style="{StaticResource FormFieldLabel}"
                               Margin="0,0,0,8"/>
                    <TextBox Text="{Binding ConcurrentRequests}"
                             Style="{StaticResource ModernTextBox}"/>
                    <TextBlock Text="Number of parallel requests (1-10)"
                               Style="{StaticResource HelperText}"/>
                </StackPanel>
                
                <!-- More fields -->
            </StackPanel>
        </Border>

        <!-- Options Section -->
        <Border Background="{StaticResource SurfaceBrush}"
                CornerRadius="8"
                Padding="24"
                Margin="0,0,0,0">
            <StackPanel>
                <TextBlock Text="Crawl Options" 
                           Style="{StaticResource FormSectionHeader}"
                           Margin="0,0,0,16"/>

                <Border Background="{StaticResource BackgroundBrush}"
                        BorderBrush="{StaticResource BorderLightBrush}"
                        BorderThickness="1"
                        CornerRadius="6"
                        Padding="12"
                        Margin="0,0,0,10">
                    <StackPanel>
                        <CheckBox IsChecked="{Binding RespectRobotsTxt}">
                            <TextBlock Text="Follow robots.txt exclusion rules" 
                                       TextWrapping="Wrap"/>
                        </CheckBox>
                        <TextBlock Text="Recommended for ethical crawling"
                                   Style="{StaticResource HelperText}"
                                   Margin="32,6,0,0"/>
                    </StackPanel>
                </Border>
            </StackPanel>
        </Border>
    </StackPanel>
</ScrollViewer>
```

### TabControl with Icons in Dialogs

**Settings Dialog Pattern:**
```xaml
<TabControl Style="{StaticResource StandardTabControl}">
    <!-- Crawling Tab -->
    <TabItem>
        <TabItem.Header>
            <StackPanel Orientation="Horizontal">
                <TextBlock Text="{StaticResource Icon.Web}"
                           Style="{StaticResource Icon}"
                           FontSize="16"
                           Margin="0,0,8,0"/>
                <TextBlock Text="Crawling" VerticalAlignment="Center"/>
            </StackPanel>
        </TabItem.Header>
        <ScrollViewer VerticalScrollBarVisibility="Auto" Padding="24,20">
            <!-- Tab content -->
        </ScrollViewer>
    </TabItem>
    
    <!-- Browser Tab -->
    <TabItem>
        <TabItem.Header>
            <StackPanel Orientation="Horizontal">
                <TextBlock Text="{StaticResource Icon.Globe}"
                           Style="{StaticResource Icon}"
                           FontSize="16"
                           Margin="0,0,8,0"/>
                <TextBlock Text="Browser" VerticalAlignment="Center"/>
            </StackPanel>
        </TabItem.Header>
        <ScrollViewer VerticalScrollBarVisibility="Auto" Padding="24,20">
            <!-- Tab content -->
        </ScrollViewer>
    </TabItem>
</TabControl>
```

### Status Bar Pattern

```xaml
<Border DockPanel.Dock="Bottom" 
        Background="{StaticResource SurfaceBrush}"
        BorderThickness="0,1,0,0"
        BorderBrush="{StaticResource BorderLightBrush}">
    <StatusBar Background="Transparent" 
               Padding="{StaticResource SpacingS}"
               AutomationProperties.Name="Status Bar"
               AutomationProperties.LiveSetting="Polite">
        <StatusBarItem>
            <StackPanel Orientation="Horizontal">
                <TextBlock Text="{StaticResource Icon.Folder}"
                           Style="{StaticResource Icon}"
                           Width="14" Height="14"
                           Foreground="{StaticResource TextSecondaryBrush}"
                           Margin="0,0,6,0"/>
                <TextBlock Text="{Binding ProjectName}" 
                           FontWeight="Medium"
                           MaxWidth="200"
                           TextTrimming="CharacterEllipsis"/>
            </StackPanel>
        </StatusBarItem>
        <Separator Margin="{StaticResource SpacingS}"/>
        <StatusBarItem AutomationProperties.LiveSetting="Polite">
            <TextBlock Text="{Binding StatusMessage}" 
                       Foreground="{StaticResource TextSecondaryBrush}"
                       TextTrimming="CharacterEllipsis"/>
        </StatusBarItem>
    </StatusBar>
</Border>
```

---

## Quick Reference Checklist

**Before You Commit:**
- [ ] Does it follow the MVVM pattern?
- [ ] Are styles from `Styles.xaml` used consistently?
- [ ] Is spacing following the system (4px base)?
- [ ] `UseLayoutRounding="True"` and `TextOptions.TextFormattingMode="Display"` on Window?
- [ ] `SnapsToDevicePixels="True"` on all Borders?
- [ ] Are AutomationProperties added (Name, HelpText, LiveSetting, HeadingLevel)?
- [ ] Does it support keyboard navigation (TabIndex, KeyboardNavigation.TabNavigation)?
- [ ] Are `IsDefault` and `IsCancel` set on dialog buttons?
- [ ] Are disposable resources properly disposed?
- [ ] Are errors handled gracefully with toasts?
- [ ] Does it match the Windows 11 look and feel?
- [ ] Is the standard page load animation applied?
- [ ] Are loading states handled (overlay or skeleton)?
- [ ] Is MaxWidth set on form content (750-850px)?

**New View Checklist:**
- [ ] UserControl with `Background="{StaticResource BackgroundBrush}"`
- [ ] Main Grid with `Margin="{StaticResource SpacingL}"` and `KeyboardNavigation.TabNavigation="Local"`
- [ ] Page load animation (TranslateTransform + opacity fade)
- [ ] Standard header with icon + title + description
- [ ] Sequential TabIndex starting from 0
- [ ] AutomationProperties on all interactive elements
- [ ] Empty state with EmptyStateContainer style

**New Dialog Checklist:**
- [ ] Window with `WindowStartupLocation="CenterOwner"`
- [ ] Three-row layout: Header, Content, Footer
- [ ] Header with icon, title, and description
- [ ] `KeyboardNavigation.TabNavigation="Cycle"` on root Grid
- [ ] `IsDefault="True"` on primary button
- [ ] `IsCancel="True"` on cancel button
- [ ] TabIndex sequential within each section
- [ ] MaxWidth on ScrollViewer content (750-900px)

Welcome to the team! 

