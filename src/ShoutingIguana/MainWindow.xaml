<Window x:Class="ShoutingIguana.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:controls="clr-namespace:ShoutingIguana.Controls"
        Title="Shouting Iguana"
        Height="800"
        Width="1200"
        MinHeight="600"
        MinWidth="850"
        Icon="Assets/logo.png"
        WindowStartupLocation="CenterScreen"
        Background="{StaticResource BackgroundBrush}"
        Foreground="{StaticResource TextPrimaryBrush}"
        UseLayoutRounding="True"
        TextOptions.TextFormattingMode="Display">
    
    <Window.InputBindings>
        <!-- File -->
        <KeyBinding Key="N" Modifiers="Control" Command="{Binding NewProjectCommand}"/>
        <KeyBinding Key="O" Modifiers="Control" Command="{Binding OpenProjectCommand}"/>
        <KeyBinding Key="W" Modifiers="Control" Command="{Binding CloseProjectCommand}"/>
        <KeyBinding Key="S" Modifiers="Control" Command="{Binding SaveProjectCommand}"/>
        <KeyBinding Key="E" Modifiers="Control" Command="{Binding ExportToExcelCommand}"/>
        <KeyBinding Key="Q" Modifiers="Control" Command="{Binding ExitCommand}"/>
        <!-- Edit -->
        <KeyBinding Key="C" Modifiers="Control" Command="{Binding CopyCommand}"/>
        <KeyBinding Key="A" Modifiers="Control" Command="{Binding SelectAllCommand}"/>
        <KeyBinding Key="F" Modifiers="Control" Command="{Binding FindCommand}"/>
        <KeyBinding Key="F" Modifiers="Control+Shift" Command="{Binding ClearFiltersCommand}"/>
        <!-- View -->
        <KeyBinding Key="D1" Modifiers="Control" Command="{Binding NavigateToProjectHomeCommand}"/>
        <KeyBinding Key="D2" Modifiers="Control" Command="{Binding NavigateToCrawlDashboardCommand}"/>
        <KeyBinding Key="D3" Modifiers="Control" Command="{Binding NavigateToFindingsCommand}"/>
        <KeyBinding Key="E" Modifiers="Control+Shift" Command="{Binding NavigateToPluginManagementCommand}"/>
        <KeyBinding Key="F5" Command="{Binding RefreshCommand}"/>
        <KeyBinding Key="F11" Command="{Binding ToggleFullScreenCommand}"/>
        <!-- Crawl -->
        <KeyBinding Key="F6" Command="{Binding StartCrawlCommand}"/>
        <KeyBinding Key="F7" Command="{Binding PauseResumeCommand}"/>
        <KeyBinding Key="F8" Command="{Binding StopCrawlCommand}"/>
        <!-- Tools -->
        <KeyBinding Key="OemComma" Modifiers="Control" Command="{Binding OptionsCommand}"/>
        <!-- Help -->
        <KeyBinding Key="F1" Command="{Binding DocumentationCommand}"/>
    </Window.InputBindings>
    
    <Grid>
        <!-- Main Content -->
        <DockPanel KeyboardNavigation.TabNavigation="Cycle">
        <!-- Menu Bar -->
        <Border DockPanel.Dock="Top" 
                Background="{StaticResource SurfaceBrush}"
                BorderThickness="0,0,0,1"
                BorderBrush="{StaticResource BorderLightBrush}"
                SnapsToDevicePixels="True">
            <Menu Background="Transparent" 
                  Padding="{StaticResource SpacingXs}"
                  IsEnabled="{Binding IsInitializing, Converter={StaticResource InverseBooleanConverter}}"
                  KeyboardNavigation.TabNavigation="Cycle"
                  AutomationProperties.Name="Main Menu"
                  AutomationProperties.HelpText="Main application menu with File, View, Crawl, Tools, and Help options"
                  AutomationProperties.IsRequiredForForm="False">
            <MenuItem Header="_File">
                <MenuItem Header="_New Project" Command="{Binding NewProjectCommand}" InputGestureText="Ctrl+N">
                    <MenuItem.Icon>
                        <TextBlock Text="{StaticResource Icon.FolderAdd}" Style="{StaticResource Icon}"/>
                    </MenuItem.Icon>
                </MenuItem>
                <MenuItem Header="_Open Project" Command="{Binding OpenProjectCommand}" InputGestureText="Ctrl+O">
                    <MenuItem.Icon>
                        <TextBlock Text="{StaticResource Icon.FolderOpen}" Style="{StaticResource Icon}"/>
                    </MenuItem.Icon>
                </MenuItem>
                <MenuItem Header="Recent Projects" x:Name="RecentProjectsMenu" ItemsSource="{Binding RecentProjects}">
                    <MenuItem.Icon>
                        <TextBlock Text="{StaticResource Icon.History}" Style="{StaticResource Icon}"/>
                    </MenuItem.Icon>
                    <MenuItem.ItemContainerStyle>
                        <Style TargetType="MenuItem" BasedOn="{StaticResource {x:Type MenuItem}}">
                            <Setter Property="Header" Value="{Binding Name}"/>
                            <Setter Property="Command" Value="{Binding DataContext.OpenRecentProjectCommand, RelativeSource={RelativeSource AncestorType=Window}}"/>
                            <Setter Property="CommandParameter" Value="{Binding}"/>
                            <Setter Property="ToolTip" Value="{Binding FilePath}"/>
                        </Style>
                    </MenuItem.ItemContainerStyle>
                    <MenuItem.Style>
                        <Style TargetType="MenuItem" BasedOn="{StaticResource {x:Type MenuItem}}">
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding RecentProjects.Count}" Value="0">
                                    <Setter Property="IsEnabled" Value="False"/>
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </MenuItem.Style>
                </MenuItem>
                <MenuItem Header="_Close Project" Command="{Binding CloseProjectCommand}" InputGestureText="Ctrl+W"
                          Visibility="{Binding HasOpenProject, Converter={StaticResource BooleanToVisibilityConverter}}">
                    <MenuItem.Icon>
                        <TextBlock Text="{StaticResource Icon.Close}" Style="{StaticResource Icon}"/>
                    </MenuItem.Icon>
                </MenuItem>
                <Separator Visibility="{Binding HasOpenProject, Converter={StaticResource BooleanToVisibilityConverter}}"/>
                <MenuItem Header="_Export"
                          Visibility="{Binding HasOpenProject, Converter={StaticResource BooleanToVisibilityConverter}}">
                    <MenuItem.Icon>
                        <TextBlock Text="{StaticResource Icon.Export}" Style="{StaticResource Icon}"/>
                    </MenuItem.Icon>
                    <MenuItem Header="Export to _CSV..." Command="{Binding ExportToCsvCommand}">
                        <MenuItem.Icon>
                            <TextBlock Text="{StaticResource Icon.FileCsv}" Style="{StaticResource Icon}"/>
                        </MenuItem.Icon>
                    </MenuItem>
                    <MenuItem Header="Export to _Excel..." Command="{Binding ExportToExcelCommand}">
                        <MenuItem.Icon>
                            <TextBlock Text="{StaticResource Icon.FileExcel}" Style="{StaticResource Icon}"/>
                        </MenuItem.Icon>
                    </MenuItem>
                </MenuItem>
                <Separator/>
                <MenuItem Header="E_xit" Command="{Binding ExitCommand}">
                    <MenuItem.Icon>
                        <TextBlock Text="{StaticResource Icon.Exit}" Style="{StaticResource Icon}"/>
                    </MenuItem.Icon>
                </MenuItem>
            </MenuItem>
            <MenuItem Header="_Edit">
                <MenuItem Header="_Copy" Command="{Binding CopyCommand}" InputGestureText="Ctrl+C">
                    <MenuItem.Icon>
                        <TextBlock Text="{StaticResource Icon.Copy}" Style="{StaticResource Icon}"/>
                    </MenuItem.Icon>
                </MenuItem>
                <MenuItem Header="Select _All" Command="{Binding SelectAllCommand}" InputGestureText="Ctrl+A">
                    <MenuItem.Icon>
                        <TextBlock Text="{StaticResource Icon.CheckList}" Style="{StaticResource Icon}"/>
                    </MenuItem.Icon>
                </MenuItem>
                <Separator Visibility="{Binding HasOpenProject, Converter={StaticResource BooleanToVisibilityConverter}}"/>
                <MenuItem Header="_Find in Findings..." Command="{Binding FindCommand}" InputGestureText="Ctrl+F"
                          Visibility="{Binding HasOpenProject, Converter={StaticResource BooleanToVisibilityConverter}}">
                    <MenuItem.Icon>
                        <TextBlock Text="{StaticResource Icon.Search}" Style="{StaticResource Icon}"/>
                    </MenuItem.Icon>
                </MenuItem>
                <MenuItem Header="Clear _Filters" Command="{Binding ClearFiltersCommand}" InputGestureText="Ctrl+Shift+F"
                          Visibility="{Binding HasOpenProject, Converter={StaticResource BooleanToVisibilityConverter}}">
                    <MenuItem.Icon>
                        <TextBlock Text="{StaticResource Icon.Remove}" Style="{StaticResource Icon}"/>
                    </MenuItem.Icon>
                </MenuItem>
            </MenuItem>
            <MenuItem Header="_View">
                <MenuItem Header="Project _Home" Command="{Binding NavigateToProjectHomeCommand}" InputGestureText="Ctrl+1"
                          Visibility="{Binding HasOpenProject, Converter={StaticResource BooleanToVisibilityConverter}}">
                    <MenuItem.Icon>
                        <TextBlock Text="{StaticResource Icon.Home}" Style="{StaticResource Icon}"/>
                    </MenuItem.Icon>
                </MenuItem>
                <MenuItem Header="Crawl _Dashboard" Command="{Binding NavigateToCrawlDashboardCommand}" InputGestureText="Ctrl+2"
                          Visibility="{Binding HasOpenProject, Converter={StaticResource BooleanToVisibilityConverter}}">
                    <MenuItem.Icon>
                        <TextBlock Text="{StaticResource Icon.ChartBar}" Style="{StaticResource Icon}"/>
                    </MenuItem.Icon>
                </MenuItem>
                <MenuItem Header="_Findings" Command="{Binding NavigateToFindingsCommand}" InputGestureText="Ctrl+3"
                          Visibility="{Binding HasOpenProject, Converter={StaticResource BooleanToVisibilityConverter}}">
                    <MenuItem.Icon>
                        <TextBlock Text="{StaticResource Icon.Search}" Style="{StaticResource Icon}"/>
                    </MenuItem.Icon>
                </MenuItem>
                <Separator/>
                <MenuItem Header="_Plugin Management" Command="{Binding NavigateToPluginManagementCommand}" InputGestureText="Ctrl+Shift+E">
                    <MenuItem.Icon>
                        <TextBlock Text="{StaticResource Icon.Puzzle}" Style="{StaticResource Icon}"/>
                    </MenuItem.Icon>
                </MenuItem>
                <Separator Visibility="{Binding HasOpenProject, Converter={StaticResource BooleanToVisibilityConverter}}"/>
                <MenuItem Header="_Refresh" Command="{Binding RefreshCommand}" InputGestureText="F5"
                          Visibility="{Binding HasOpenProject, Converter={StaticResource BooleanToVisibilityConverter}}">
                    <MenuItem.Icon>
                        <TextBlock Text="{StaticResource Icon.Refresh}" Style="{StaticResource Icon}"/>
                    </MenuItem.Icon>
                </MenuItem>
                <MenuItem Header="Toggle _Full Screen" Command="{Binding ToggleFullScreenCommand}" InputGestureText="F11">
                    <MenuItem.Icon>
                        <TextBlock Text="{StaticResource Icon.Web}" Style="{StaticResource Icon}"/>
                    </MenuItem.Icon>
                </MenuItem>
            </MenuItem>
            <MenuItem Header="_Crawl"
                      Visibility="{Binding HasOpenProject, Converter={StaticResource BooleanToVisibilityConverter}}">
                <MenuItem Header="_Start Crawl" Command="{Binding StartCrawlCommand}" InputGestureText="F6">
                    <MenuItem.Icon>
                        <TextBlock Text="{StaticResource Icon.Play}" Style="{StaticResource Icon}"/>
                    </MenuItem.Icon>
                </MenuItem>
                <MenuItem Header="{Binding PauseResumeMenuText}" Command="{Binding PauseResumeCommand}" InputGestureText="F7">
                    <MenuItem.Icon>
                        <TextBlock Text="{Binding PauseResumeIcon}" Style="{StaticResource Icon}"/>
                    </MenuItem.Icon>
                </MenuItem>
                <MenuItem Header="Sto_p Crawl" Command="{Binding StopCrawlCommand}" InputGestureText="F8">
                    <MenuItem.Icon>
                        <TextBlock Text="{StaticResource Icon.Stop}" Style="{StaticResource Icon}"/>
                    </MenuItem.Icon>
                </MenuItem>
                <Separator/>
                <MenuItem Header="C_lear Queue" Command="{Binding ClearQueueCommand}">
                    <MenuItem.Icon>
                        <TextBlock Text="{StaticResource Icon.Remove}" Style="{StaticResource Icon}"/>
                    </MenuItem.Icon>
                </MenuItem>
                <MenuItem Header="_Reset Project Data..." Command="{Binding ResetProjectDataCommand}">
                    <MenuItem.Icon>
                        <TextBlock Text="{StaticResource Icon.Delete}" Style="{StaticResource Icon}"/>
                    </MenuItem.Icon>
                </MenuItem>
            </MenuItem>
            <MenuItem Header="_Tools">
                <MenuItem Header="_Import URL List..." Command="{Binding ImportUrlListCommand}"
                          Visibility="{Binding HasOpenProject, Converter={StaticResource BooleanToVisibilityConverter}}">
                    <MenuItem.Icon>
                        <TextBlock Text="{StaticResource Icon.Import}" Style="{StaticResource Icon}"/>
                    </MenuItem.Icon>
                </MenuItem>
                <MenuItem Header="Custom _Extraction..." Command="{Binding CustomExtractionCommand}"
                          Visibility="{Binding HasOpenProject, Converter={StaticResource BooleanToVisibilityConverter}}">
                    <MenuItem.Icon>
                        <TextBlock Text="{StaticResource Icon.Code}" Style="{StaticResource Icon}"/>
                    </MenuItem.Icon>
                </MenuItem>
                <Separator Visibility="{Binding HasOpenProject, Converter={StaticResource BooleanToVisibilityConverter}}"/>
                <MenuItem Header="Test _Proxy Connection..." Command="{Binding TestProxyCommand}">
                    <MenuItem.Icon>
                        <TextBlock Text="{StaticResource Icon.Globe}" Style="{StaticResource Icon}"/>
                    </MenuItem.Icon>
                </MenuItem>
                <MenuItem Header="Reinstall Playwright _Browsers..." Command="{Binding ReinstallBrowsersCommand}">
                    <MenuItem.Icon>
                        <TextBlock Text="{StaticResource Icon.Web}" Style="{StaticResource Icon}"/>
                    </MenuItem.Icon>
                </MenuItem>
                <Separator/>
                <MenuItem Header="_Settings..." Command="{Binding OptionsCommand}" InputGestureText="Ctrl+,">
                    <MenuItem.Icon>
                        <TextBlock Text="{StaticResource Icon.Settings}" Style="{StaticResource Icon}"/>
                    </MenuItem.Icon>
                </MenuItem>
            </MenuItem>
            <MenuItem Header="_Help">
                <MenuItem Header="_Documentation" Command="{Binding DocumentationCommand}" InputGestureText="F1">
                    <MenuItem.Icon>
                        <TextBlock Text="{StaticResource Icon.Document}" Style="{StaticResource Icon}"/>
                    </MenuItem.Icon>
                </MenuItem>
                <MenuItem Header="_Plugin Development Guide" Command="{Binding PluginDevGuideCommand}">
                    <MenuItem.Icon>
                        <TextBlock Text="{StaticResource Icon.Code}" Style="{StaticResource Icon}"/>
                    </MenuItem.Icon>
                </MenuItem>
                <Separator/>
                <MenuItem Header="_Check for Updates..." Command="{Binding CheckAppUpdatesCommand}">
                    <MenuItem.Icon>
                        <TextBlock Text="{StaticResource Icon.Refresh}" Style="{StaticResource Icon}"/>
                    </MenuItem.Icon>
                </MenuItem>
                <MenuItem Header="View _Logs..." Command="{Binding ViewLogsCommand}">
                    <MenuItem.Icon>
                        <TextBlock Text="{StaticResource Icon.Document}" Style="{StaticResource Icon}"/>
                    </MenuItem.Icon>
                </MenuItem>
                <MenuItem Header="_Report Issue..." Command="{Binding ReportIssueCommand}">
                    <MenuItem.Icon>
                        <TextBlock Text="{StaticResource Icon.Warning}" Style="{StaticResource Icon}"/>
                    </MenuItem.Icon>
                </MenuItem>
                <Separator/>
                <MenuItem Header="_About Shouting Iguana..." Command="{Binding AboutCommand}">
                    <MenuItem.Icon>
                        <TextBlock Text="{StaticResource Icon.Info}" Style="{StaticResource Icon}"/>
                    </MenuItem.Icon>
                </MenuItem>
            </MenuItem>
            </Menu>
        </Border>

        <!-- Status Bar -->
        <Border DockPanel.Dock="Bottom" 
                Background="{StaticResource SurfaceBrush}"
                BorderThickness="0,1,0,0"
                BorderBrush="{StaticResource BorderLightBrush}"
                SnapsToDevicePixels="True">
            <StatusBar Background="Transparent" 
                       Padding="{StaticResource SpacingS}"
                       KeyboardNavigation.TabNavigation="None"
                       AutomationProperties.Name="Status Bar"
                       AutomationProperties.LiveSetting="Polite">
                <StatusBarItem AutomationProperties.Name="Project Name">
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Text="{StaticResource Icon.Folder}"
                                   Style="{StaticResource Icon}"
                                   Width="14" 
                                   Height="14"
                                   FontSize="14"
                                   Foreground="{StaticResource TextSecondaryBrush}"
                                   Margin="0,0,6,0"
                                   VerticalAlignment="Center"/>
                        <TextBlock Text="{Binding ProjectName}" 
                                   VerticalAlignment="Center"
                                   Foreground="{StaticResource TextPrimaryBrush}"
                                   FontWeight="Medium"
                                   TextTrimming="CharacterEllipsis"
                                   MaxWidth="200"
                                   ToolTip="{Binding ProjectName}"/>
                    </StackPanel>
                </StatusBarItem>
                <Separator Margin="{StaticResource SpacingS}" Background="{StaticResource BorderLightBrush}"/>
                <StatusBarItem AutomationProperties.Name="Status Message" 
                               AutomationProperties.LiveSetting="Polite">
                    <TextBlock Text="{Binding StatusMessage}" 
                               VerticalAlignment="Center"
                               Foreground="{StaticResource TextSecondaryBrush}"
                               TextTrimming="CharacterEllipsis"/>
                </StatusBarItem>
                <Separator Margin="{StaticResource SpacingS}" Background="{StaticResource BorderLightBrush}"/>
                <StatusBarItem AutomationProperties.Name="Browser Status"
                               AutomationProperties.LiveSetting="Polite">
                    <StackPanel Orientation="Horizontal" 
                                ToolTip="Playwright browser engine status">
                        <TextBlock Text="{StaticResource Icon.Web}"
                                   Style="{StaticResource Icon}"
                                   Width="14" 
                                   Height="14"
                                   FontSize="14"
                                   Foreground="{StaticResource TextSecondaryBrush}"
                                   Margin="0,0,6,0"
                                   VerticalAlignment="Center"/>
                        <TextBlock Text="Browser: " 
                                   VerticalAlignment="Center"
                                   Foreground="{StaticResource TextSecondaryBrush}"/>
                        <TextBlock Text="{Binding BrowserStatusText}" 
                                   VerticalAlignment="Center"
                                   Margin="4,0,0,0"
                                   Foreground="{StaticResource TextPrimaryBrush}"
                                   FontWeight="SemiBold"
                                   AutomationProperties.LiveSetting="Polite"/>
                    </StackPanel>
                </StatusBarItem>
                <Separator Margin="{StaticResource SpacingS}" 
                           Background="{StaticResource BorderLightBrush}"
                           Visibility="{Binding HasOpenProject, Converter={StaticResource BooleanToVisibilityConverter}}"/>
                <StatusBarItem AutomationProperties.Name="Plugin Count"
                               Visibility="{Binding HasOpenProject, Converter={StaticResource BooleanToVisibilityConverter}}">
                    <StackPanel Orientation="Horizontal" 
                                ToolTip="Number of loaded plugins">
                        <TextBlock Text="{StaticResource Icon.Puzzle}"
                                   Style="{StaticResource Icon}"
                                   Width="14" 
                                   Height="14"
                                   FontSize="14"
                                   Foreground="{StaticResource TextSecondaryBrush}"
                                   Margin="0,0,6,0"
                                   VerticalAlignment="Center"/>
                        <TextBlock Text="{Binding PluginCount, StringFormat='{}{0} plugins'}" 
                                   VerticalAlignment="Center"
                                   Foreground="{StaticResource TextSecondaryBrush}"/>
                    </StackPanel>
                </StatusBarItem>
            </StatusBar>
        </Border>

            <!-- Content Area -->
            <ContentControl Content="{Binding CurrentView}" 
                            KeyboardNavigation.TabNavigation="Local"
                            Focusable="False"
                            AutomationProperties.Name="Main Content Area"
                            AutomationProperties.HelpText="Main application content changes based on selected view"/>
        </DockPanel>
        
        <!-- Toast Notifications Container -->
        <ItemsControl ItemsSource="{Binding Toasts}"
                      VerticalAlignment="Top"
                      HorizontalAlignment="Right"
                      Margin="24,80,24,0"
                      Panel.ZIndex="1000"
                      IsHitTestVisible="False">
            <ItemsControl.ItemsPanel>
                <ItemsPanelTemplate>
                    <StackPanel/>
                </ItemsPanelTemplate>
            </ItemsControl.ItemsPanel>
            <ItemsControl.ItemTemplate>
                <DataTemplate>
                    <controls:ToastNotification DataContext="{Binding}" IsHitTestVisible="True"/>
                </DataTemplate>
            </ItemsControl.ItemTemplate>
        </ItemsControl>
    </Grid>
    
</Window>
