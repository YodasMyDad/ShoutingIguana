<UserControl x:Class="ShoutingIguana.Views.ExtensionsView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:vm="clr-namespace:ShoutingIguana.ViewModels"
             mc:Ignorable="d"
             Background="{StaticResource BackgroundBrush}">
    
    <UserControl.InputBindings>
        <KeyBinding Key="F5" Command="{Binding RefreshPluginsCommand}"/>
    </UserControl.InputBindings>
    
    <Grid Margin="{StaticResource SpacingL}" KeyboardNavigation.TabNavigation="Local">
        <Grid.RenderTransform>
            <TranslateTransform/>
        </Grid.RenderTransform>
        <Grid.Triggers>
            <EventTrigger RoutedEvent="Loaded">
                <BeginStoryboard>
                    <Storyboard>
                        <DoubleAnimation Storyboard.TargetProperty="(UIElement.RenderTransform).(TranslateTransform.Y)"
                                         From="20" To="0" Duration="0:0:0.4"
                                         DecelerationRatio="0.7"/>
                        <DoubleAnimation Storyboard.TargetProperty="Opacity"
                                         From="0" To="1" Duration="0:0:0.4"
                                         DecelerationRatio="0.7"/>
                    </Storyboard>
                </BeginStoryboard>
            </EventTrigger>
        </Grid.Triggers>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <Border Grid.Row="0"
                Background="{StaticResource SurfaceBrush}"
                CornerRadius="8"
                Padding="24"
                Margin="0,0,0,24"
                SnapsToDevicePixels="True">
            <Border.Effect>
                <DropShadowEffect Color="#000000" BlurRadius="8" ShadowDepth="2" Opacity="0.06"/>
            </Border.Effect>
            <Grid>
                <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                    <Border Background="{StaticResource PrimaryBrush}"
                            Width="44" Height="44"
                            CornerRadius="8"
                            Margin="0,0,16,0">
                        <TextBlock Text="{StaticResource Icon.Puzzle}"
                                   Style="{StaticResource Icon}"
                                   FontSize="22"
                                   Foreground="White"/>
                    </Border>
                    <StackPanel VerticalAlignment="Center">
                        <TextBlock Text="Extensions Manager" 
                                   Style="{StaticResource DisplayTextStyle}"
                                   FontSize="24"
                                   Margin="0"
                                   AutomationProperties.HeadingLevel="Level1"
                                   AutomationProperties.LiveSetting="Off"
                                   AutomationProperties.AutomationId="ExtensionsPageHeading"/>
                        <TextBlock Text="Install, update, and manage analysis plugins"
                                   Style="{StaticResource BodyTextStyle}"
                                   Foreground="{StaticResource TextSecondaryBrush}"
                                   Margin="0,4,0,0"/>
                    </StackPanel>
                </StackPanel>
                
                <StackPanel Orientation="Horizontal"
                            HorizontalAlignment="Right"
                            VerticalAlignment="Center"
                            KeyboardNavigation.TabNavigation="Local">
                    <Button Command="{Binding CheckForUpdatesCommand}"
                            Style="{StaticResource SecondaryButton}"
                            ToolTip="Check for plugin updates"
                            Margin="0,0,8,0"
                            TabIndex="0"
                            AutomationProperties.Name="Check for Plugin Updates"
                            AutomationProperties.HelpText="Checks all installed plugins for available updates from the configured NuGet feeds">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="{StaticResource Icon.Refresh}"
                                       Style="{StaticResource Icon}"
                                       Width="16"
                                       Height="16"
                                       Margin="0,0,6,0"/>
                            <TextBlock Text="Check Updates" VerticalAlignment="Center"/>
                        </StackPanel>
                    </Button>
                    <!-- Updates badge -->
                    <Border Background="{StaticResource ErrorBrush}"
                            CornerRadius="12"
                            Padding="8,4"
                            Visibility="{Binding UpdatesAvailable, Converter={StaticResource Int32ToVisibilityConverter}}">
                        <TextBlock Text="{Binding UpdatesAvailable, StringFormat='{}{0} Updates'}"
                                   Foreground="White"
                                   FontSize="12"
                                   FontWeight="SemiBold"/>
                    </Border>
                </StackPanel>
            </Grid>
        </Border>

        <!-- Summary Stats -->
        <Grid Grid.Row="1" Margin="0,0,0,24">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="16"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <Border Grid.Column="0" Style="{StaticResource MetricCard}">
                <StackPanel>
                    <TextBlock Text="{Binding TotalPlugins}"
                               Style="{StaticResource DisplayTextStyle}"
                               FontSize="32"
                               Foreground="{StaticResource PrimaryBrush}"/>
                    <TextBlock Text="Installed Plugins"
                               Style="{StaticResource CaptionTextStyle}"/>
                </StackPanel>
            </Border>

            <Border Grid.Column="2" Style="{StaticResource MetricCard}">
                <StackPanel>
                    <TextBlock Text="{Binding TotalTasks}"
                               Style="{StaticResource DisplayTextStyle}"
                               FontSize="32"
                               Foreground="{StaticResource SuccessBrush}"/>
                    <TextBlock Text="Registered Tasks"
                               Style="{StaticResource CaptionTextStyle}"/>
                </StackPanel>
            </Border>
        </Grid>

        <!-- Main Content: Two-Panel Layout -->
        <Grid Grid.Row="2">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="2*" MinWidth="400"/>
                <ColumnDefinition Width="16"/>
                <ColumnDefinition Width="1*" MinWidth="300"/>
            </Grid.ColumnDefinitions>

            <!-- Left Panel: Tabs for Installed and Browse -->
            <Border Grid.Column="0" Style="{StaticResource Card}">
                <TabControl SelectedIndex="{Binding SelectedTabIndex}"
                            Style="{StaticResource StandardTabControl}">
                    
                    <!-- Installed Tab -->
                    <TabItem Header="Installed">
                        <Grid>
                            <!-- Skeleton Loader (shown while loading) -->
                            <ItemsControl Visibility="{Binding IsLoading, Converter={StaticResource BooleanToVisibilityConverter}}"
                                          Margin="12">
                                <ItemsControl.Items>
                                    <!-- 8 skeleton rows -->
                                    <Border Style="{StaticResource SkeletonRow}">
                                        <Grid Margin="12,0">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="80"/>
                                                <ColumnDefinition Width="100"/>
                                                <ColumnDefinition Width="60"/>
                                            </Grid.ColumnDefinitions>
                                            <Rectangle Grid.Column="0" Style="{StaticResource SkeletonCell}" Width="180"/>
                                            <Rectangle Grid.Column="1" Style="{StaticResource SkeletonCell}" Width="60"/>
                                            <Rectangle Grid.Column="2" Style="{StaticResource SkeletonCell}" Width="80"/>
                                            <Rectangle Grid.Column="3" Style="{StaticResource SkeletonCell}" Width="40"/>
                                        </Grid>
                                    </Border>
                                    <Border Style="{StaticResource SkeletonRow}">
                                        <Grid Margin="12,0">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="80"/>
                                                <ColumnDefinition Width="100"/>
                                                <ColumnDefinition Width="60"/>
                                            </Grid.ColumnDefinitions>
                                            <Rectangle Grid.Column="0" Style="{StaticResource SkeletonCell}" Width="160"/>
                                            <Rectangle Grid.Column="1" Style="{StaticResource SkeletonCell}" Width="60"/>
                                            <Rectangle Grid.Column="2" Style="{StaticResource SkeletonCell}" Width="80"/>
                                            <Rectangle Grid.Column="3" Style="{StaticResource SkeletonCell}" Width="40"/>
                                        </Grid>
                                    </Border>
                                    <Border Style="{StaticResource SkeletonRow}">
                                        <Grid Margin="12,0">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="80"/>
                                                <ColumnDefinition Width="100"/>
                                                <ColumnDefinition Width="60"/>
                                            </Grid.ColumnDefinitions>
                                            <Rectangle Grid.Column="0" Style="{StaticResource SkeletonCell}" Width="200"/>
                                            <Rectangle Grid.Column="1" Style="{StaticResource SkeletonCell}" Width="60"/>
                                            <Rectangle Grid.Column="2" Style="{StaticResource SkeletonCell}" Width="80"/>
                                            <Rectangle Grid.Column="3" Style="{StaticResource SkeletonCell}" Width="40"/>
                                        </Grid>
                                    </Border>
                                    <Border Style="{StaticResource SkeletonRow}">
                                        <Grid Margin="12,0">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="80"/>
                                                <ColumnDefinition Width="100"/>
                                                <ColumnDefinition Width="60"/>
                                            </Grid.ColumnDefinitions>
                                            <Rectangle Grid.Column="0" Style="{StaticResource SkeletonCell}" Width="170"/>
                                            <Rectangle Grid.Column="1" Style="{StaticResource SkeletonCell}" Width="60"/>
                                            <Rectangle Grid.Column="2" Style="{StaticResource SkeletonCell}" Width="80"/>
                                            <Rectangle Grid.Column="3" Style="{StaticResource SkeletonCell}" Width="40"/>
                                        </Grid>
                                    </Border>
                                    <Border Style="{StaticResource SkeletonRow}">
                                        <Grid Margin="12,0">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="80"/>
                                                <ColumnDefinition Width="100"/>
                                                <ColumnDefinition Width="60"/>
                                            </Grid.ColumnDefinitions>
                                            <Rectangle Grid.Column="0" Style="{StaticResource SkeletonCell}" Width="190"/>
                                            <Rectangle Grid.Column="1" Style="{StaticResource SkeletonCell}" Width="60"/>
                                            <Rectangle Grid.Column="2" Style="{StaticResource SkeletonCell}" Width="80"/>
                                            <Rectangle Grid.Column="3" Style="{StaticResource SkeletonCell}" Width="40"/>
                                        </Grid>
                                    </Border>
                                    <Border Style="{StaticResource SkeletonRow}">
                                        <Grid Margin="12,0">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="80"/>
                                                <ColumnDefinition Width="100"/>
                                                <ColumnDefinition Width="60"/>
                                            </Grid.ColumnDefinitions>
                                            <Rectangle Grid.Column="0" Style="{StaticResource SkeletonCell}" Width="175"/>
                                            <Rectangle Grid.Column="1" Style="{StaticResource SkeletonCell}" Width="60"/>
                                            <Rectangle Grid.Column="2" Style="{StaticResource SkeletonCell}" Width="80"/>
                                            <Rectangle Grid.Column="3" Style="{StaticResource SkeletonCell}" Width="40"/>
                                        </Grid>
                                    </Border>
                                    <Border Style="{StaticResource SkeletonRow}">
                                        <Grid Margin="12,0">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="80"/>
                                                <ColumnDefinition Width="100"/>
                                                <ColumnDefinition Width="60"/>
                                            </Grid.ColumnDefinitions>
                                            <Rectangle Grid.Column="0" Style="{StaticResource SkeletonCell}" Width="185"/>
                                            <Rectangle Grid.Column="1" Style="{StaticResource SkeletonCell}" Width="60"/>
                                            <Rectangle Grid.Column="2" Style="{StaticResource SkeletonCell}" Width="80"/>
                                            <Rectangle Grid.Column="3" Style="{StaticResource SkeletonCell}" Width="40"/>
                                        </Grid>
                                    </Border>
                                    <Border Style="{StaticResource SkeletonRow}">
                                        <Grid Margin="12,0">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="80"/>
                                                <ColumnDefinition Width="100"/>
                                                <ColumnDefinition Width="60"/>
                                            </Grid.ColumnDefinitions>
                                            <Rectangle Grid.Column="0" Style="{StaticResource SkeletonCell}" Width="195"/>
                                            <Rectangle Grid.Column="1" Style="{StaticResource SkeletonCell}" Width="60"/>
                                            <Rectangle Grid.Column="2" Style="{StaticResource SkeletonCell}" Width="80"/>
                                            <Rectangle Grid.Column="3" Style="{StaticResource SkeletonCell}" Width="40"/>
                                        </Grid>
                                    </Border>
                                </ItemsControl.Items>
                            </ItemsControl>

                            <!-- Installed Plugins DataGrid -->
                            <DataGrid ItemsSource="{Binding InstalledPlugins}"
                                      SelectedItem="{Binding SelectedInstalledPlugin}"
                                      Style="{StaticResource ModernDataGrid}"
                                      Visibility="{Binding IsLoading, Converter={StaticResource InverseBooleanToVisibilityConverter}}"
                                      TabIndex="0"
                                      AutomationProperties.Name="Installed Plugins"
                                      AutomationProperties.HelpText="List of installed plugins. Select a plugin to view details and manage it.">
                                <DataGrid.ContextMenu>
                                    <ContextMenu AutomationProperties.Name="Plugin Context Menu">
                                        <MenuItem Header="Update Plugin" 
                                                  Command="{Binding UpdatePluginCommand}"
                                                  AutomationProperties.Name="Update Plugin to Latest Version">
                                            <MenuItem.Icon>
                                                <TextBlock Text="{StaticResource Icon.Refresh}" Style="{StaticResource Icon}"/>
                                            </MenuItem.Icon>
                                        </MenuItem>
                                        <MenuItem Header="Uninstall Plugin" 
                                                  Command="{Binding UninstallPluginCommand}"
                                                  AutomationProperties.Name="Uninstall Plugin">
                                            <MenuItem.Icon>
                                                <TextBlock Text="{StaticResource Icon.Delete}" Style="{StaticResource Icon}"/>
                                            </MenuItem.Icon>
                                        </MenuItem>
                                    </ContextMenu>
                                </DataGrid.ContextMenu>
                                <DataGrid.Columns>
                                    <DataGridTextColumn Header="Name" 
                                                        Binding="{Binding Name}" 
                                                        Width="*"
                                                        FontWeight="SemiBold"/>
                                    <DataGridTextColumn Header="Version" 
                                                        Binding="{Binding Version}" 
                                                        Width="80"/>
                                    <DataGridTemplateColumn Header="Status" Width="100">
                                        <DataGridTemplateColumn.CellTemplate>
                                            <DataTemplate DataType="{x:Type vm:InstalledPluginViewModel}">
                                                <Border Background="{StaticResource SuccessBackgroundBrush}"
                                                        CornerRadius="12"
                                                        Padding="8,4"
                                                        HorizontalAlignment="Center">
                                                    <TextBlock Text="{Binding Status}"
                                                               Foreground="{StaticResource SuccessBrush}"
                                                               FontWeight="SemiBold"
                                                               FontSize="11"/>
                                                </Border>
                                            </DataTemplate>
                                        </DataGridTemplateColumn.CellTemplate>
                                    </DataGridTemplateColumn>
                                    <DataGridTextColumn Header="Tasks" 
                                                        Binding="{Binding TaskCount}" 
                                                        Width="60">
                                        <DataGridTextColumn.ElementStyle>
                                            <Style TargetType="TextBlock">
                                                <Setter Property="HorizontalAlignment" Value="Center"/>
                                                <Setter Property="FontWeight" Value="Bold"/>
                                            </Style>
                                        </DataGridTextColumn.ElementStyle>
                                    </DataGridTextColumn>
                                </DataGrid.Columns>
                            </DataGrid>

                            <!-- Empty State -->
                            <StackPanel Style="{StaticResource EmptyStateContainer}"
                                        Visibility="{Binding TotalPlugins, Converter={StaticResource InverseInt32ToVisibilityConverter}}">
                                <TextBlock Text="{StaticResource Icon.Puzzle}"
                                           Style="{StaticResource EmptyStateIcon}"/>
                                <TextBlock Text="No Plugins Installed"
                                           Style="{StaticResource EmptyStateTitle}"/>
                                <TextBlock Text="Install plugins from the Browse tab to extend functionality."
                                           Style="{StaticResource EmptyStateMessage}"/>
                            </StackPanel>
                        </Grid>
                    </TabItem>

                    <!-- Browse Tab -->
                    <TabItem Header="Browse">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="*"/>
                            </Grid.RowDefinitions>

                            <!-- Search Box -->
                            <Border Grid.Row="0" 
                                    Background="{StaticResource SurfaceAltBrush}"
                                    Padding="16"
                                    Margin="0,0,0,16">
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>

                                    <TextBox Grid.Column="0"
                                             Text="{Binding SearchQuery, UpdateSourceTrigger=PropertyChanged}"
                                             Style="{StaticResource ModernTextBox}"
                                             TabIndex="1"
                                             AutomationProperties.Name="Search Plugins"
                                             AutomationProperties.HelpText="Search for available plugins in the NuGet feed by name or description"
                                             ToolTip="Search for plugins by name or description">
                                        <TextBox.Tag>Search for plugins...</TextBox.Tag>
                                    </TextBox>

                                    <ProgressBar Grid.Column="1"
                                                 IsIndeterminate="True"
                                                 Style="{StaticResource ModernProgressBar}"
                                                 Width="24" Height="24"
                                                 Margin="12,0,0,0"
                                                 Visibility="{Binding IsSearching, Converter={StaticResource BooleanToVisibilityConverter}}"/>
                                </Grid>
                            </Border>

                            <!-- Skeleton Loader (shown while loading) -->
                            <ItemsControl Grid.Row="1"
                                          Visibility="{Binding IsSearching, Converter={StaticResource BooleanToVisibilityConverter}}"
                                          Margin="12">
                                <ItemsControl.Items>
                                    <!-- 8 skeleton rows -->
                                    <Border Style="{StaticResource SkeletonRow}">
                                        <Grid Margin="12,0">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="80"/>
                                                <ColumnDefinition Width="100"/>
                                                <ColumnDefinition Width="90"/>
                                            </Grid.ColumnDefinitions>
                                            <Rectangle Grid.Column="0" Style="{StaticResource SkeletonCell}" Width="190"/>
                                            <Rectangle Grid.Column="1" Style="{StaticResource SkeletonCell}" Width="60"/>
                                            <Rectangle Grid.Column="2" Style="{StaticResource SkeletonCell}" Width="70"/>
                                            <Rectangle Grid.Column="3" Style="{StaticResource SkeletonCell}" Width="70"/>
                                        </Grid>
                                    </Border>
                                    <Border Style="{StaticResource SkeletonRow}">
                                        <Grid Margin="12,0">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="80"/>
                                                <ColumnDefinition Width="100"/>
                                                <ColumnDefinition Width="90"/>
                                            </Grid.ColumnDefinitions>
                                            <Rectangle Grid.Column="0" Style="{StaticResource SkeletonCell}" Width="170"/>
                                            <Rectangle Grid.Column="1" Style="{StaticResource SkeletonCell}" Width="60"/>
                                            <Rectangle Grid.Column="2" Style="{StaticResource SkeletonCell}" Width="70"/>
                                            <Rectangle Grid.Column="3" Style="{StaticResource SkeletonCell}" Width="70"/>
                                        </Grid>
                                    </Border>
                                    <Border Style="{StaticResource SkeletonRow}">
                                        <Grid Margin="12,0">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="80"/>
                                                <ColumnDefinition Width="100"/>
                                                <ColumnDefinition Width="90"/>
                                            </Grid.ColumnDefinitions>
                                            <Rectangle Grid.Column="0" Style="{StaticResource SkeletonCell}" Width="185"/>
                                            <Rectangle Grid.Column="1" Style="{StaticResource SkeletonCell}" Width="60"/>
                                            <Rectangle Grid.Column="2" Style="{StaticResource SkeletonCell}" Width="70"/>
                                            <Rectangle Grid.Column="3" Style="{StaticResource SkeletonCell}" Width="70"/>
                                        </Grid>
                                    </Border>
                                    <Border Style="{StaticResource SkeletonRow}">
                                        <Grid Margin="12,0">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="80"/>
                                                <ColumnDefinition Width="100"/>
                                                <ColumnDefinition Width="90"/>
                                            </Grid.ColumnDefinitions>
                                            <Rectangle Grid.Column="0" Style="{StaticResource SkeletonCell}" Width="200"/>
                                            <Rectangle Grid.Column="1" Style="{StaticResource SkeletonCell}" Width="60"/>
                                            <Rectangle Grid.Column="2" Style="{StaticResource SkeletonCell}" Width="70"/>
                                            <Rectangle Grid.Column="3" Style="{StaticResource SkeletonCell}" Width="70"/>
                                        </Grid>
                                    </Border>
                                    <Border Style="{StaticResource SkeletonRow}">
                                        <Grid Margin="12,0">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="80"/>
                                                <ColumnDefinition Width="100"/>
                                                <ColumnDefinition Width="90"/>
                                            </Grid.ColumnDefinitions>
                                            <Rectangle Grid.Column="0" Style="{StaticResource SkeletonCell}" Width="175"/>
                                            <Rectangle Grid.Column="1" Style="{StaticResource SkeletonCell}" Width="60"/>
                                            <Rectangle Grid.Column="2" Style="{StaticResource SkeletonCell}" Width="70"/>
                                            <Rectangle Grid.Column="3" Style="{StaticResource SkeletonCell}" Width="70"/>
                                        </Grid>
                                    </Border>
                                    <Border Style="{StaticResource SkeletonRow}">
                                        <Grid Margin="12,0">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="80"/>
                                                <ColumnDefinition Width="100"/>
                                                <ColumnDefinition Width="90"/>
                                            </Grid.ColumnDefinitions>
                                            <Rectangle Grid.Column="0" Style="{StaticResource SkeletonCell}" Width="195"/>
                                            <Rectangle Grid.Column="1" Style="{StaticResource SkeletonCell}" Width="60"/>
                                            <Rectangle Grid.Column="2" Style="{StaticResource SkeletonCell}" Width="70"/>
                                            <Rectangle Grid.Column="3" Style="{StaticResource SkeletonCell}" Width="70"/>
                                        </Grid>
                                    </Border>
                                    <Border Style="{StaticResource SkeletonRow}">
                                        <Grid Margin="12,0">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="80"/>
                                                <ColumnDefinition Width="100"/>
                                                <ColumnDefinition Width="90"/>
                                            </Grid.ColumnDefinitions>
                                            <Rectangle Grid.Column="0" Style="{StaticResource SkeletonCell}" Width="180"/>
                                            <Rectangle Grid.Column="1" Style="{StaticResource SkeletonCell}" Width="60"/>
                                            <Rectangle Grid.Column="2" Style="{StaticResource SkeletonCell}" Width="70"/>
                                            <Rectangle Grid.Column="3" Style="{StaticResource SkeletonCell}" Width="70"/>
                                        </Grid>
                                    </Border>
                                    <Border Style="{StaticResource SkeletonRow}">
                                        <Grid Margin="12,0">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="80"/>
                                                <ColumnDefinition Width="100"/>
                                                <ColumnDefinition Width="90"/>
                                            </Grid.ColumnDefinitions>
                                            <Rectangle Grid.Column="0" Style="{StaticResource SkeletonCell}" Width="165"/>
                                            <Rectangle Grid.Column="1" Style="{StaticResource SkeletonCell}" Width="60"/>
                                            <Rectangle Grid.Column="2" Style="{StaticResource SkeletonCell}" Width="70"/>
                                            <Rectangle Grid.Column="3" Style="{StaticResource SkeletonCell}" Width="70"/>
                                        </Grid>
                                    </Border>
                                </ItemsControl.Items>
                            </ItemsControl>

                            <!-- Browse Results -->
                            <DataGrid Grid.Row="1"
                                      ItemsSource="{Binding BrowseResults}"
                                      SelectedItem="{Binding SelectedBrowsePlugin}"
                                      Style="{StaticResource ModernDataGrid}"
                                      Visibility="{Binding IsSearching, Converter={StaticResource InverseBooleanToVisibilityConverter}}"
                                      TabIndex="2">
                                <DataGrid.Columns>
                                    <DataGridTextColumn Header="Name" 
                                                        Binding="{Binding Name}" 
                                                        Width="*"
                                                        FontWeight="SemiBold"/>
                                    <DataGridTextColumn Header="Version" 
                                                        Binding="{Binding Version}" 
                                                        Width="80"/>
                                    <DataGridTextColumn Header="Downloads" 
                                                        Binding="{Binding DownloadCount, StringFormat=N0}" 
                                                        Width="100">
                                        <DataGridTextColumn.ElementStyle>
                                            <Style TargetType="TextBlock">
                                                <Setter Property="HorizontalAlignment" Value="Right"/>
                                            </Style>
                                        </DataGridTextColumn.ElementStyle>
                                    </DataGridTextColumn>
                                    <DataGridTemplateColumn Header="Status" Width="90">
                                        <DataGridTemplateColumn.CellTemplate>
                                            <DataTemplate DataType="{x:Type vm:BrowsePluginViewModel}">
                                                <Border CornerRadius="12"
                                                        Padding="8,4"
                                                        HorizontalAlignment="Center">
                                                    <Border.Style>
                                                        <Style TargetType="Border">
                                                            <Style.Triggers>
                                                                <DataTrigger Binding="{Binding IsInstalled}" Value="True">
                                                                    <Setter Property="Background" Value="{StaticResource SuccessBackgroundBrush}"/>
                                                                </DataTrigger>
                                                                <DataTrigger Binding="{Binding IsInstalled}" Value="False">
                                                                    <Setter Property="Background" Value="{StaticResource InfoBackgroundBrush}"/>
                                                                </DataTrigger>
                                                            </Style.Triggers>
                                                        </Style>
                                                    </Border.Style>
                                                    <TextBlock FontWeight="SemiBold" FontSize="11" HorizontalAlignment="Center">
                                                        <TextBlock.Style>
                                                            <Style TargetType="TextBlock">
                                                                <Style.Triggers>
                                                                    <DataTrigger Binding="{Binding IsInstalled}" Value="True">
                                                                        <Setter Property="Text" Value="Installed"/>
                                                                        <Setter Property="Foreground" Value="{StaticResource SuccessBrush}"/>
                                                                    </DataTrigger>
                                                                    <DataTrigger Binding="{Binding IsInstalled}" Value="False">
                                                                        <Setter Property="Text" Value="Available"/>
                                                                        <Setter Property="Foreground" Value="{StaticResource PrimaryBrush}"/>
                                                                    </DataTrigger>
                                                                </Style.Triggers>
                                                            </Style>
                                                        </TextBlock.Style>
                                                    </TextBlock>
                                                </Border>
                                            </DataTemplate>
                                        </DataGridTemplateColumn.CellTemplate>
                                    </DataGridTemplateColumn>
                                </DataGrid.Columns>
                            </DataGrid>

                            <!-- Empty Browse State -->
                            <StackPanel Grid.Row="1"
                                        Style="{StaticResource EmptyStateContainer}"
                                        Visibility="{Binding BrowseResults.Count, Converter={StaticResource InverseInt32ToVisibilityConverter}}">
                                <TextBlock Text="{StaticResource Icon.Search}"
                                           Style="{StaticResource EmptyStateIcon}"/>
                                <TextBlock Text="Search for Plugins"
                                           Style="{StaticResource EmptyStateTitle}"/>
                                <TextBlock Text="Enter a search term above to browse available plugins."
                                           Style="{StaticResource EmptyStateMessage}"/>
                            </StackPanel>
                        </Grid>
                    </TabItem>
                </TabControl>
            </Border>

            <!-- Right Panel: Details and Actions -->
            <Border Grid.Column="2" Style="{StaticResource Card}">
                <Grid>
                    <!-- Installed Plugin Details -->
                    <ScrollViewer Grid.Row="0"
                                  VerticalScrollBarVisibility="Auto"
                                  Visibility="{Binding SelectedInstalledPlugin, Converter={StaticResource NullToVisibilityConverter}}">
                        <StackPanel Margin="24">
                            <!-- Plugin Header -->
                            <StackPanel Orientation="Horizontal" Margin="0,0,0,16">
                                <Border Background="{StaticResource PrimaryBrush}"
                                        Width="48" Height="48"
                                        CornerRadius="8"
                                        Margin="0,0,12,0">
                                    <TextBlock Text="{StaticResource Icon.Puzzle}"
                                               Style="{StaticResource Icon}"
                                               FontSize="20"
                                               Foreground="White"/>
                                </Border>
                                <StackPanel VerticalAlignment="Center">
                                    <TextBlock Text="{Binding SelectedInstalledPlugin.Name}"
                                               Style="{StaticResource SubtitleTextStyle}"/>
                                    <TextBlock Text="{Binding SelectedInstalledPlugin.Version, StringFormat='v{0}'}"
                                               Style="{StaticResource CaptionTextStyle}"/>
                                </StackPanel>
                            </StackPanel>

                            <!-- Description -->
                            <TextBlock Text="Description"
                                       Style="{StaticResource BodyEmphasisTextStyle}"
                                       Margin="0,0,0,8"/>
                            <TextBlock Text="{Binding SelectedInstalledPlugin.Description}"
                                       Style="{StaticResource BodyTextStyle}"
                                       TextWrapping="Wrap"
                                       Foreground="{StaticResource TextSecondaryBrush}"
                                       Margin="0,0,0,24"/>

                            <!-- Info Grid -->
                            <Grid Margin="0,0,0,24">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="8"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="8"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>

                                <TextBlock Grid.Row="0" Grid.Column="0"
                                           Text="Status:"
                                           Style="{StaticResource BodyTextStyle}"
                                           Foreground="{StaticResource TextSecondaryBrush}"/>
                                <TextBlock Grid.Row="0" Grid.Column="1"
                                           Text="{Binding SelectedInstalledPlugin.Status}"
                                           Style="{StaticResource BodyEmphasisTextStyle}"
                                           Foreground="{StaticResource SuccessBrush}"
                                           Margin="8,0,0,0"/>

                                <TextBlock Grid.Row="2" Grid.Column="0"
                                           Text="Tasks:"
                                           Style="{StaticResource BodyTextStyle}"
                                           Foreground="{StaticResource TextSecondaryBrush}"/>
                                <TextBlock Grid.Row="2" Grid.Column="1"
                                           Text="{Binding SelectedInstalledPlugin.TaskCount}"
                                           Style="{StaticResource BodyEmphasisTextStyle}"
                                           Margin="8,0,0,0"/>

                                <TextBlock Grid.Row="4" Grid.Column="0"
                                           Text="Package:"
                                           Style="{StaticResource BodyTextStyle}"
                                           Foreground="{StaticResource TextSecondaryBrush}"/>
                                <TextBlock Grid.Row="4" Grid.Column="1"
                                           Text="{Binding SelectedInstalledPlugin.PackageId}"
                                           Style="{StaticResource CaptionTextStyle}"
                                           FontFamily="Consolas"
                                           Margin="8,0,0,0"/>
                            </Grid>

                            <!-- Update Notice -->
                            <Border Style="{StaticResource WarningMessageCard}"
                                    Margin="0,0,0,16"
                                    Visibility="{Binding SelectedInstalledPlugin.HasUpdate, Converter={StaticResource BooleanToVisibilityConverter}}">
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock Text="{StaticResource Icon.Warning}"
                                               Style="{StaticResource Icon}"
                                               Foreground="{StaticResource WarningBrush}"
                                               Margin="0,0,12,0"/>
                                    <TextBlock Text="Update available"
                                               Style="{StaticResource BodyTextStyle}"/>
                                </StackPanel>
                            </Border>

                            <!-- Built-in Notice -->
                            <Border Style="{StaticResource InfoCard}"
                                    Margin="0,0,0,16"
                                    Visibility="{Binding SelectedInstalledPlugin.IsBuiltIn, Converter={StaticResource BooleanToVisibilityConverter}}">
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock Text="{StaticResource Icon.Info}"
                                               Style="{StaticResource Icon}"
                                               Foreground="{StaticResource InfoBrush}"
                                               Margin="0,0,12,0"/>
                                    <TextBlock Text="Built-in plugin (cannot be uninstalled)"
                                               Style="{StaticResource BodyTextStyle}"/>
                                </StackPanel>
                            </Border>

                            <!-- Actions -->
                            <StackPanel>
                                <Button Content="Update Plugin"
                                        Command="{Binding UpdatePluginCommand}"
                                        Style="{StaticResource PrimaryButton}"
                                        TabIndex="3"
                                        Margin="0,0,0,8"
                                        Visibility="{Binding SelectedInstalledPlugin.HasUpdate, Converter={StaticResource BooleanToVisibilityConverter}}"
                                        AutomationProperties.Name="Update Plugin"
                                        AutomationProperties.HelpText="Updates the selected plugin to the latest available version"
                                        ToolTip="Update to the latest version"/>
                                
                                <Button Content="Uninstall"
                                        Command="{Binding UninstallPluginCommand}"
                                        Style="{StaticResource DangerButton}"
                                        TabIndex="4"
                                        Visibility="{Binding SelectedInstalledPlugin.IsBuiltIn, Converter={StaticResource InverseBooleanToVisibilityConverter}}"
                                        AutomationProperties.Name="Uninstall Plugin"
                                        AutomationProperties.HelpText="Permanently removes the selected plugin from the application"
                                        ToolTip="Uninstall this plugin"/>
                            </StackPanel>
                        </StackPanel>
                    </ScrollViewer>

                    <!-- Browse Plugin Details -->
                    <ScrollViewer Grid.Row="0"
                                  VerticalScrollBarVisibility="Auto"
                                  Visibility="{Binding SelectedBrowsePlugin, Converter={StaticResource NullToVisibilityConverter}}">
                        <StackPanel Margin="24">
                            <!-- Plugin Header -->
                            <StackPanel Orientation="Horizontal" Margin="0,0,0,16">
                                <Border Background="{StaticResource PrimaryBrush}"
                                        Width="48" Height="48"
                                        CornerRadius="8"
                                        Margin="0,0,12,0">
                                    <TextBlock Text="{StaticResource Icon.Puzzle}"
                                               Style="{StaticResource Icon}"
                                               FontSize="20"
                                               Foreground="White"/>
                                </Border>
                                <StackPanel VerticalAlignment="Center">
                                    <TextBlock Text="{Binding SelectedBrowsePlugin.Name}"
                                               Style="{StaticResource SubtitleTextStyle}"/>
                                    <TextBlock Text="{Binding SelectedBrowsePlugin.Version, StringFormat='v{0}'}"
                                               Style="{StaticResource CaptionTextStyle}"/>
                                </StackPanel>
                            </StackPanel>

                            <!-- Description -->
                            <TextBlock Text="Description"
                                       Style="{StaticResource BodyEmphasisTextStyle}"
                                       Margin="0,0,0,8"/>
                            <TextBlock Text="{Binding SelectedBrowsePlugin.Description}"
                                       Style="{StaticResource BodyTextStyle}"
                                       TextWrapping="Wrap"
                                       Foreground="{StaticResource TextSecondaryBrush}"
                                       Margin="0,0,0,24"/>

                            <!-- Info Grid -->
                            <Grid Margin="0,0,0,24">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="8"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="8"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>

                                <TextBlock Grid.Row="0" Grid.Column="0"
                                           Text="Author:"
                                           Style="{StaticResource BodyTextStyle}"
                                           Foreground="{StaticResource TextSecondaryBrush}"/>
                                <TextBlock Grid.Row="0" Grid.Column="1"
                                           Text="{Binding SelectedBrowsePlugin.Authors}"
                                           Style="{StaticResource BodyTextStyle}"
                                           Margin="8,0,0,0"/>

                                <TextBlock Grid.Row="2" Grid.Column="0"
                                           Text="Downloads:"
                                           Style="{StaticResource BodyTextStyle}"
                                           Foreground="{StaticResource TextSecondaryBrush}"/>
                                <TextBlock Grid.Row="2" Grid.Column="1"
                                           Text="{Binding SelectedBrowsePlugin.DownloadCount, StringFormat=N0}"
                                           Style="{StaticResource BodyTextStyle}"
                                           Margin="8,0,0,0"/>

                                <TextBlock Grid.Row="4" Grid.Column="0"
                                           Text="Package ID:"
                                           Style="{StaticResource BodyTextStyle}"
                                           Foreground="{StaticResource TextSecondaryBrush}"/>
                                <TextBlock Grid.Row="4" Grid.Column="1"
                                           Text="{Binding SelectedBrowsePlugin.PackageId}"
                                           Style="{StaticResource CaptionTextStyle}"
                                           FontFamily="Consolas"
                                           Margin="8,0,0,0"/>
                            </Grid>

                            <!-- Already Installed Notice -->
                            <Border Style="{StaticResource InfoCard}"
                                    Margin="0,0,0,16"
                                    Visibility="{Binding SelectedBrowsePlugin.IsInstalled, Converter={StaticResource BooleanToVisibilityConverter}}">
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock Text="{StaticResource Icon.Success}"
                                               Style="{StaticResource Icon}"
                                               Foreground="{StaticResource SuccessBrush}"
                                               Margin="0,0,12,0"/>
                                    <TextBlock Text="Already installed"
                                               Style="{StaticResource BodyTextStyle}"/>
                                </StackPanel>
                            </Border>

                            <!-- Install Button -->
                            <Button Content="Install Plugin"
                                    Command="{Binding InstallPluginCommand}"
                                    Style="{StaticResource PrimaryButton}"
                                    TabIndex="5"
                                    AutomationProperties.Name="Install Plugin"
                                    AutomationProperties.HelpText="Downloads and installs the selected plugin from the NuGet feed"/>

                            <!-- Install Progress -->
                            <Border Style="{StaticResource InfoCard}"
                                    Margin="0,16,0,0"
                                    Visibility="{Binding IsInstalling, Converter={StaticResource BooleanToVisibilityConverter}}">
                                <StackPanel>
                                    <TextBlock Text="{Binding InstallStatus}"
                                               Style="{StaticResource BodyEmphasisTextStyle}"
                                               Margin="0,0,0,8"/>
                                    <ProgressBar Value="{Binding InstallProgress}"
                                                 Maximum="100"
                                                 Style="{StaticResource ModernProgressBar}"/>
                                    <TextBlock Text="{Binding InstallProgress, StringFormat='{}{0}%'}"
                                               Style="{StaticResource CaptionTextStyle}"
                                               HorizontalAlignment="Center"
                                               Margin="0,4,0,0"/>
                                </StackPanel>
                            </Border>
                        </StackPanel>
                    </ScrollViewer>

                    <!-- No Selection State - default panel -->
                    <StackPanel Grid.Row="0">
                        <StackPanel.Style>
                            <Style TargetType="StackPanel" BasedOn="{StaticResource EmptyStateContainer}">
                                <Setter Property="Visibility" Value="Collapsed"/>
                                <Style.Triggers>
                                    <MultiDataTrigger>
                                        <MultiDataTrigger.Conditions>
                                            <Condition Binding="{Binding SelectedInstalledPlugin}" Value="{x:Null}"/>
                                            <Condition Binding="{Binding SelectedBrowsePlugin}" Value="{x:Null}"/>
                                        </MultiDataTrigger.Conditions>
                                        <Setter Property="Visibility" Value="Visible"/>
                                    </MultiDataTrigger>
                                </Style.Triggers>
                            </Style>
                        </StackPanel.Style>
                        <TextBlock Text="{StaticResource Icon.Puzzle}"
                                   Style="{StaticResource EmptyStateIcon}"/>
                        <TextBlock Text="No Plugin Selected"
                                   Style="{StaticResource EmptyStateTitle}"/>
                        <TextBlock Text="Select a plugin to view details."
                                   Style="{StaticResource EmptyStateMessage}"/>
                    </StackPanel>
                </Grid>
            </Border>
        </Grid>
    </Grid>
</UserControl>
